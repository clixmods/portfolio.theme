{{ define "main" }}
  {{/* CV Page - uses data from /data */}}
  {{ $profile := site.Data.profile }}
  {{ $experiences := (.Site.GetPage "/experiences").Pages.ByParam "start_date" }}
  {{ $educations := (where (.Site.GetPage "/educations").Pages "File.BaseFileName" "!=" "_index") }}
  {{ $specialties := site.Data.specialties }}
  {{ $softSkills := site.Data.soft_skills }}
  {{ $programmingLanguages := site.Data.programming_languages }}
  {{ $frameworksEngines := site.Data.frameworks_engines }}
  {{ $technologies := site.Data.technologies }}
  {{/* Certifications removed from CV */}}

  {{/* Ensure CV stylesheet is loaded for this page */}}
  {{ $cvStyles := resources.Get "scss/cv.scss" | toCSS | minify }}
  <link rel="stylesheet" href="{{ $cvStyles.RelPermalink }}" />

  <style media="print">
    /* Force hiding of site chrome during printing */
    #dock, #hero-background, footer, .contact-modal, .toast-container, .trophies-modal, .right-dock, .top-dock { display: none !important; }
    body { background: #fff !important; }
    main { margin: 0 !important; padding: 0 !important; }
    .cv-page { box-shadow: none !important; margin: 0 !important; padding: 0 !important; max-width: 100% !important; }
    .cv-export { display: none !important; }
    /* Page setup for PDF export */
    @page { size: A4; margin: 12mm; }
  </style>

  {{ $cvStyle := or .Params.cvStyle "twocol" }}
  {{ $cvAccent := or .Params.cvAccent "#111111" }}
  <section class="cv-page cv--{{ $cvStyle }}" id="cv" style="--cv-accent: {{ $cvAccent }};">
    <header class="cv-header">
      <div class="cv-identite">
        <div class="cv-id-row">
          {{ with $profile.media.profileImage }}
            <img class="cv-avatar cv-avatar--header" src="{{ . }}" alt="{{ $profile.personal.fullName }}">
          {{ end }}
          <div>
            <h1>{{ or $profile.personal.fullName (printf "%s %s" $profile.personal.firstName $profile.personal.lastName) }}</h1>
            {{ with $profile.contact.status }}<p class="cv-title">{{ . }}</p>{{ end }}
            {{ with $profile.personal.subtitle }}<p class="cv-subtag">{{ . }}</p>{{ end }}
          </div>
        </div>
      </div>
      <div class="cv-coordonnees">
        <ul class="cv-contact-list">
          {{ with $profile.contact.email }}<li>{{ . }}</li>{{ end }}
          {{ with $profile.contact.linkedin }}<li><a href="https://{{ . }}" target="_blank" rel="noopener">{{ . }}</a></li>{{ end }}
          {{ with $profile.contact.location }}<li>{{ . }}</li>{{ end }}
          {{ with $profile.contact.phone }}<li>{{ . }}</li>{{ end }}
        </ul>
        <button class="cv-export" onclick="window.print()">üñ®Ô∏è Exporter en PDF</button>
      </div>
    </header>

    <div class="cv-grid">
      <div class="cv-col cv-col-left">
        <section class="cv-section cv-summary">
          <div class="cv-summary-top">
            <div class="cv-summary-text">
              {{ with $profile.personal.title }}<p class="cv-item-desc">{{ . }}</p>{{ end }}
            </div>
          </div>
          {{ with $specialties }}
            {{ range . }}
              {{ with .category }}
                <ul class="cv-summary-bullets">
                  <li>D√©veloppeur logiciel et de jeu vid√©o passionn√©</li>
                  <li>Expertise dans :
                    <ul>
                      {{ range first 4 .skills }}<li>{{ .name }}</li>{{ end }}
                    </ul>
                  </li>
                </ul>
              {{ end }}
            {{ end }}
          {{ end }}
        </section>

    {{ if $programmingLanguages }}
      <section class="cv-section cv-languages">
        <h2>Langage Prog.</h2>
        <ul class="cv-tags cv-language-tags">
          {{ range first 6 (sort $programmingLanguages "experience" "desc") }}
            {{ $exp := .experience }}
            <li class="cv-language-tag">
              <span class="cv-lang-name">{{ .name }}</span>
              <span class="cv-lang-exp">
                {{ if ge $exp 1 }}
                  {{ printf "%.0f" $exp }} {{ if eq (printf "%.0f" $exp) "1" }}an{{ else }}ans{{ end }}
                {{ else }}
                  {{ printf "%.0f" (mul $exp 12) }} mois
                {{ end }}
              </span>
            </li>
          {{ end }}
        </ul>
      </section>
    {{ end }}

    {{ if $educations }}
          <section class="cv-section cv-formations">
            <h2>Formations</h2>
            <ul class="cv-list cv-formations-list">
              {{ range first 3 (sort $educations "Params.start_date" "desc") }}
                <li class="cv-item cv-formation-item">
                  <div class="cv-formation-content">
                    <div class="cv-formation-main">
                      <div class="cv-formation-degree">{{ .Title }}</div>
                      <div class="cv-formation-institution">
                        {{ .Params.institution }}{{ if .Params.city }} - {{ .Params.city }}{{ end }}
                      </div>
                      {{ with .Params.status }}
                        <div class="cv-formation-status">{{ . }}</div>
                      {{ end }}
                    </div>
                    <div class="cv-formation-period">
                      {{ if .Params.start_date }}
                        {{ dateFormat "2006" .Params.start_date }}{{ if .Params.end_date }} / {{ dateFormat "2006" .Params.end_date }}{{ else }} / En cours{{ end }}
                      {{ end }}
                    </div>
                  </div>
                </li>
              {{ end }}
            </ul>
          </section>
        {{ end }}

        {{/* Interests (optional, displayed if available or fallback) */}}
        {{ $interests := or $profile.details.interests $profile.personal.interests }}
        {{ if or $interests (eq .Site.Language.Lang "fr") }}
          <section class="cv-section">
            <h2>Centres d'int√©r√™t</h2>
            <ul class="cv-tags">
              {{ if $interests }}
                {{ range $interests }}<li>{{ . }}</li>{{ end }}
              {{ else }}
                <li>Dessin</li>
                <li>Jeux vid√©o</li>
                <li>Musique</li>
                <li>Technologies</li>
              {{ end }}
            </ul>
          </section>
        {{ end }}
      </div>
      <div class="cv-col cv-col-right">

        {{ if $experiences }}
          <section class="cv-section cv-experiences-section">
            <h2>Exp√©riences Pro.</h2>
            {{ range $i, $exp := first 2 $experiences }}
              {{ $experienceData := partial "helpers/experience-data.html" $exp }}
              <div class="cv-experience-item">
                <div class="cv-experience-header">
                  <div class="cv-experience-main">
                    <h3 class="cv-experience-title">{{ $exp.Title }}</h3>
                    <div class="cv-experience-company">{{ $exp.Params.company }}</div>
                    {{ with $exp.Params.location }}<div class="cv-experience-location">{{ . }}</div>{{ end }}
                  </div>
                  <div class="cv-experience-period">
                    {{ $experienceData.period }}{{ with $experienceData.duration }}<br><span class="cv-experience-duration">{{ . }}</span>{{ end }}
                  </div>
                </div>
                
                {{ with $exp.Params.description }}
                  <div class="cv-experience-description">{{ . | truncate 180 }}</div>
                {{ end }}
                
                {{/* Skills and technologies used */}}
                {{ if or $exp.Params.programming_languages $exp.Params.frameworks_engines $exp.Params.specialties $exp.Params.soft_skills }}
                  <div class="cv-experience-tags">
                    {{ with $exp.Params.specialties }}
                      {{ range first 3 . }}<span class="cv-experience-tag cv-tag-specialty">{{ . }}</span>{{ end }}
                    {{ end }}
                    {{ with $exp.Params.programming_languages }}
                      {{ range first 3 . }}<span class="cv-experience-tag cv-tag-lang">{{ . }}</span>{{ end }}
                    {{ end }}
                    {{ with $exp.Params.frameworks_engines }}
                      {{ range first 3 . }}<span class="cv-experience-tag cv-tag-framework">{{ . }}</span>{{ end }}
                    {{ end }}
                    {{ with $exp.Params.soft_skills }}
                      {{ range first 2 . }}<span class="cv-experience-tag cv-tag-soft">{{ . }}</span>{{ end }}
                    {{ end }}
                  </div>
                {{ end }}
              </div>
            {{ end }}
          </section>
        {{ end }}

        {{/* Projects (compact, selected) */}}
        {{ $allProjects := where .Site.RegularPages "Section" "projects" }}
        {{ $sortedAll := sort $allProjects "Date" "desc" }}
        {{ $featuredCV := where $allProjects "Params.featuredInCV" true }}
        {{ $featured := where $allProjects "Params.featured" true }}
        {{ $preferred := union $featuredCV $featured }}
        {{ $projLimit := 4 }}
        {{/* Concat preferred (sorted) + all (sorted), deduplicating */}}
        {{ $sortedPreferred := sort $preferred "Date" "desc" }}
        {{ $combined := union $sortedPreferred $sortedAll }}
        {{ $projects := first $projLimit $combined }}
        {{ if gt (len $projects) 0 }}
          <section class="cv-section cv-projects-section">
            <h2>Projets Informatique</h2>
            
            {{/* Specific projects mentioned - search in all projects */}}
            {{ $stoneKeeper := where $allProjects "File.TranslationBaseName" "stone-keepers" }}
            {{ $terraMemoria := where $allProjects "File.TranslationBaseName" "terra-memoria" }}
            {{ $gameShowcase := where $allProjects "File.TranslationBaseName" "my-game-showcase" }}
            
            {{/* Individual projects - My Game Showcase, Terra Memoria, Stone Keeper */}}
            {{ range $gameShowcase }}
              <div class="cv-project-individual cv-project-with-bg" {{ with .Params.image }}style="background-image: url('{{ . }}')"{{ end }}>
                <div class="cv-project-header">
                  <div class="cv-project-main">
                    <h3 class="cv-project-title">{{ .Title }}</h3>
                    {{ with .Params.subtitle }}<div class="cv-project-subtitle">{{ . }}</div>{{ end }}
                  </div>
                  <div class="cv-project-period">
                    {{ with .Params.date }}{{ dateFormat "2006" . }}{{ end }}
                  </div>
                </div>
                {{ with .Params.description }}
                  <div class="cv-project-description">{{ . | plainify | truncate 160 }}</div>
                {{ end }}
                
                {{/* Technical tags for this project */}}
                <div class="cv-project-tags">
                  {{ with .Params.specialties }}
                    {{ range . }}<span class="cv-project-tag cv-tag-specialty">{{ . }}</span>{{ end }}
                  {{ end }}
                  {{ with .Params.programming_languages }}
                    {{ range . }}<span class="cv-project-tag cv-tag-lang">{{ . }}</span>{{ end }}
                  {{ end }}
                  {{ with .Params.frameworks_engines }}
                    {{ range . }}<span class="cv-project-tag cv-tag-framework">{{ . }}</span>{{ end }}
                  {{ end }}
                </div>
              </div>
            {{ end }}
            
            {{ range $terraMemoria }}
              <div class="cv-project-individual cv-project-with-bg" {{ with .Params.image }}style="background-image: url('{{ . }}')"{{ end }}>
                <div class="cv-project-header">
                  <div class="cv-project-main">
                    <h3 class="cv-project-title">{{ .Title }}</h3>
                    {{ with .Params.subtitle }}<div class="cv-project-subtitle">{{ . }}</div>{{ end }}
                  </div>
                  <div class="cv-project-period">
                    {{ with .Params.date }}{{ dateFormat "2006" . }}{{ end }}
                  </div>
                </div>
                {{ with .Params.description }}
                  <div class="cv-project-description">{{ . | plainify | truncate 160 }}</div>
                {{ end }}
                
                {{/* Technical tags for this project */}}
                <div class="cv-project-tags">
                  {{ with .Params.specialties }}
                    {{ range . }}<span class="cv-project-tag cv-tag-specialty">{{ . }}</span>{{ end }}
                  {{ end }}
                  {{ with .Params.programming_languages }}
                    {{ range . }}<span class="cv-project-tag cv-tag-lang">{{ . }}</span>{{ end }}
                  {{ end }}
                  {{ with .Params.frameworks_engines }}
                    {{ range . }}<span class="cv-project-tag cv-tag-framework">{{ . }}</span>{{ end }}
                  {{ end }}
                </div>
              </div>
            {{ end }}
            
            {{ range $stoneKeeper }}
              <div class="cv-project-individual cv-project-with-bg" {{ with .Params.image }}style="background-image: url('{{ . }}')"{{ end }}>
                <div class="cv-project-header">
                  <div class="cv-project-main">
                    <h3 class="cv-project-title">{{ .Title }}</h3>
                    {{ with .Params.subtitle }}<div class="cv-project-subtitle">{{ . }}</div>{{ end }}
                  </div>
                  <div class="cv-project-period">
                    {{ with .Params.date }}{{ dateFormat "2006" . }}{{ end }}
                  </div>
                </div>
                {{ with .Params.description }}
                  <div class="cv-project-description">{{ . | plainify | truncate 160 }}</div>
                {{ end }}
                
                {{/* Technical tags for this project */}}
                <div class="cv-project-tags">
                  {{ with .Params.specialties }}
                    {{ range . }}<span class="cv-project-tag cv-tag-specialty">{{ . }}</span>{{ end }}
                  {{ end }}
                  {{ with .Params.programming_languages }}
                    {{ range . }}<span class="cv-project-tag cv-tag-lang">{{ . }}</span>{{ end }}
                  {{ end }}
                  {{ with .Params.frameworks_engines }}
                    {{ range . }}<span class="cv-project-tag cv-tag-framework">{{ . }}</span>{{ end }}
                  {{ end }}
                </div>
              </div>
            {{ end }}
            
            {{/* Study projects - grouping */}}
            <div class="cv-project-individual">
              <div class="cv-project-header">
                <div class="cv-project-main">
                  <h3 class="cv-project-title">Projets d'√©tudes</h3>
                </div>
                <div class="cv-project-period">2021/2024</div>
              </div>
              
              <div class="cv-project-description">
                13 projets r√©alis√©s sur <strong>Unity</strong> et <strong>Unreal</strong> en √©quipe restreinte pendant les √©tudes.
              </div>
              
              <div class="cv-project-tags">
                <span class="cv-project-tag cv-tag-specialty">Gestion de projet</span>
                <span class="cv-project-tag cv-tag-specialty">M√©thode agile</span>
                <span class="cv-project-tag cv-tag-specialty">Travail en √©quipe</span>
                <span class="cv-project-tag cv-tag-lang">C#</span>
                <span class="cv-project-tag cv-tag-framework">Unity</span>
                <span class="cv-project-tag cv-tag-framework">.NET</span>
              </div>
            </div>
            
            {{/* Game Jam section */}}
            <div class="cv-project-individual">
              <div class="cv-project-header">
                <div class="cv-project-main">
                  <h3 class="cv-project-title">Game Jam</h3>
                </div>
                <div class="cv-project-period">2020/2024</div>
              </div>
              
              <div class="cv-project-description">
                Cr√©ation de jeux vid√©o en <strong>temps restreint</strong> et <strong>contrainte</strong>, avec une √©quipe al√©atoire (derni√®rement la Global Game Jam 2024 et les Ludum Jam 1to3).
              </div>
              
              <div class="cv-project-tags">
                <span class="cv-project-tag cv-tag-specialty">Cr√©ation agile</span>
                <span class="cv-project-tag cv-tag-specialty">Game Design</span>
                <span class="cv-project-tag cv-tag-specialty">D√©veloppement rapide</span>
                <span class="cv-project-tag cv-tag-specialty">Adaptation</span>
              </div>
            </div>
            
            {{/* Modding section */}}
            <div class="cv-project-individual">
              <div class="cv-project-header">
                <div class="cv-project-main">
                  <h3 class="cv-project-title">Modding</h3>
                </div>
                <div class="cv-project-period">2016/2019</div>
              </div>
              
              <div class="cv-project-description">
                <strong>Contenu de jeu vid√©o</strong> pour le Steam Workshop de <strong>Call of Duty Black Ops 3</strong>.
                + 800 000 t√©l√©chargements cumul√©s ‚Ä¢ Management communautaire
              </div>
              
              <div class="cv-project-tags">
                <span class="cv-project-tag cv-tag-specialty">Contenu de jeu vid√©o</span>
                <span class="cv-project-tag cv-tag-specialty">Steam Workshop</span>
                <span class="cv-project-tag cv-tag-specialty">Management communautaire</span>
                <span class="cv-project-tag cv-tag-framework">Call of Duty Black Ops 3</span>
              </div>
            </div>
            
          </section>
        {{ end }}

        {{/* Certifications section intentionally removed */}}


      </div>
    </div>
  </section>
  <script>
    (function(){
      try {
        const params = new URLSearchParams(window.location.search);
        if (params.get('download') === '1') {
          // Wait a tick to ensure layout is complete before printing
          window.addEventListener('load', function(){
            setTimeout(function(){ window.print(); }, 150);
          });
        }
      } catch (e) { /* ignore */ }
    })();
  </script>
{{ end }}
