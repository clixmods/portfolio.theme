{{ define "main" }}
{{/* ============================================================================ */}}
{{/* BRANDING PREVIEW PAGE */}}
{{/* ============================================================================ */}}
{{/* Interactive branding thumbnail editor with modular partial structure */}}
{{/* */}}
{{/* Partials used: */}}
{{/* - params-service-card.html     : Service card editor parameters */}}
{{/* - params-project-showcase.html : Project selector parameters */}}
{{/* - params-portfolio-card.html   : Portfolio card parameters */}}
{{/* - params-skill-highlight.html  : Skill highlight parameters */}}
{{/* - params-linkedin-header.html  : LinkedIn header parameters */}}
{{/* - technology-selector.html     : Technology tabs and lists */}}
{{/* - style-options.html           : Style controls (gradient, colors) */}}
{{/* - preview-controls.html        : Resolution, zoom, export controls */}}
{{/* - template-*.html              : Individual template previews */}}
{{/* - js-data.html                 : JavaScript data injection */}}
{{/* ============================================================================ */}}

{{/* Load html2canvas library for PNG export - using unpkg for reliability */}}
<script src="https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

{{/* Load SCSS assets */}}
{{ $brandingCSSResource := resources.Get "scss/branding/branding.scss" }}
{{ if $brandingCSSResource }}
{{ $brandingCSS := $brandingCSSResource | css.Sass | resources.Minify }}
<link rel="stylesheet" href="{{ $brandingCSS.RelPermalink }}">
{{ end }}

{{/* Load JS modules (order matters) */}}
{{ $jsModules := slice 
    "js/branding/state.js"
    "js/branding/utils.js"
    "js/branding/sidebar.js"
    "js/branding/preview.js"
    "js/branding/templates.js"
    "js/branding/editor.js"
    "js/branding/technologies.js"
    "js/branding/controls-effects.js"
    "js/branding/controls-linkedin.js"
    "js/branding/controls-service-card.js"
    "js/branding/controls-portfolio-card.js"
    "js/branding/controls-skill-highlight.js"
    "js/branding/controls-project-showcase.js"
    "js/branding/controls-resolution.js"
    "js/branding/controls.js"
    "js/branding/export.js"
    "js/branding/branding.js"
}}
{{ range $jsModules }}
{{ $jsResource := resources.Get . }}
{{ if $jsResource }}
{{ $js := $jsResource | resources.Minify }}
<script src="{{ $js.RelPermalink }}" defer></script>
{{ end }}
{{ end }}

{{/* Load all data sources */}}
{{ $profile := partial "get-localized-data.html" (dict "context" . "dataName" "profile") }}
{{ $programmingLanguages := .Site.Data.programming_languages }}
{{ $frameworksEngines := .Site.Data.frameworks_engines }}
{{ $tools := .Site.Data.tools }}
{{ $specialties := .Site.Data.specialties }}
{{ $projects := where .Site.RegularPages "Section" "projects" }}

<div class="branding-page">
    <div class="branding-layout">
        
        {{/* ================================================================ */}}
        {{/* EDITOR SIDEBAR */}}
        {{/* ================================================================ */}}
        <aside class="branding-editor-sidebar" id="editor-sidebar">
            <div class="sidebar-header">
                <h2>Editeur</h2>
                <button class="sidebar-toggle" id="toggle-sidebar" title="Masquer l'editeur">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                </button>
            </div>

            {{/* Template Selection */}}
            <div class="editor-section">
                <h3>Template</h3>
                <div class="template-grid">
                    <button class="template-card active" data-template="service-card">
                        <span class="template-icon">ðŸŽ¯</span>
                        <span class="template-name">Service Fiverr</span>
                    </button>
                    <button class="template-card" data-template="project-showcase">
                        <span class="template-icon">ðŸŽ®</span>
                        <span class="template-name">Projet</span>
                    </button>
                    <button class="template-card" data-template="portfolio-card">
                        <span class="template-icon">ðŸ‘¤</span>
                        <span class="template-name">Portfolio</span>
                    </button>
                    <button class="template-card" data-template="skill-highlight">
                        <span class="template-icon">âš¡</span>
                        <span class="template-name">Competences</span>
                    </button>
                    <button class="template-card" data-template="linkedin-header">
                        <span class="template-icon">ðŸ’¼</span>
                        <span class="template-name">LinkedIn Header</span>
                    </button>
                </div>
            </div>

            {{/* Template-specific parameters */}}
            {{ partial "branding/params-service-card.html" . }}
            {{ partial "branding/params-project-showcase.html" (dict "projects" $projects) }}
            {{ partial "branding/params-portfolio-card.html" . }}
            {{ partial "branding/params-skill-highlight.html" . }}
            {{ partial "branding/params-linkedin-header.html" . }}

            {{/* Technology selector */}}
            {{ partial "branding/technology-selector.html" (dict 
                "programmingLanguages" $programmingLanguages 
                "frameworksEngines" $frameworksEngines 
                "tools" $tools 
                "specialties" $specialties
            ) }}

            {{/* Style options */}}
            {{ partial "branding/style-options.html" . }}
        </aside>

        {{/* ================================================================ */}}
        {{/* PREVIEW AREA */}}
        {{/* ================================================================ */}}
        <main class="branding-preview-area">
            {{/* Controls bar */}}
            {{ partial "branding/preview-controls.html" . }}

            {{/* Preview container with all templates */}}
            <div class="preview-wrapper">
                <div class="preview-container" id="preview-container">
                    <div class="preview-canvas" id="preview-canvas" style="width: 1280px; height: 720px;">
                        {{/* Global overlays - applied on top of all templates */}}
                        {{ partial "branding/template-overlays.html" . }}
                        
                        {{ partial "branding/template-service-card.html" (dict "profile" $profile) }}
                        {{ partial "branding/template-project-showcase.html" (dict "profile" $profile) }}
                        {{ partial "branding/template-portfolio-card.html" (dict "profile" $profile) }}
                        {{ partial "branding/template-skill-highlight.html" (dict "profile" $profile) }}
                        {{ partial "branding/template-linkedin-header.html" (dict "profile" $profile) }}
                    </div>
                </div>
            </div>
        </main>
    </div>

    {{/* Collapsed sidebar toggle */}}
    <button class="sidebar-show-btn hidden" id="show-sidebar" title="Afficher l'editeur">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
        Editeur
    </button>
</div>

{{/* JavaScript data injection */}}
{{ partial "branding/js-data.html" (dict 
    "profile" $profile 
    "programmingLanguages" $programmingLanguages 
    "frameworksEngines" $frameworksEngines 
    "tools" $tools 
    "specialties" $specialties
) }}

{{ end }}
