{{ define "main" }}

<div class="container projects-list-page">
    <!-- Progress bar pour indiquer le d√©filement -->
    <div class="scroll-progress">
        <div class="scroll-progress-bar"></div>
    </div>
    
    <main class="main-content projects-list-content">
        <!-- Projects Section -->
        <section class="projects-section projects-page">
            <div class="projects-header section-header-unified">
                <h1 class="section-title-unified">{{ i18n "projects_title" | default (i18n "projects") }}</h1>
                <p class="projects-subtitle section-subtitle-unified">{{ i18n "projects_subtitle" | default "Construire des applications utiles qui simplifient la vie." }}</p>
            </div>

            {{/* Calculate project counts for each category */}}
            {{ $gamesCount := 0 }}
            {{ $appsWebCount := 0 }}
            {{ $modsToolsCount := 0 }}
            
            {{ range where $.Site.RegularPages "Section" "projects" }}
                {{ if hasPrefix .Params.sector "games" }}
                    {{ $gamesCount = add $gamesCount 1 }}
                {{ else if hasPrefix .Params.sector "appsweb" }}
                    {{ $appsWebCount = add $appsWebCount 1 }}
                {{ else if or (eq .Params.sector "mods") (eq .Params.sector "tools") }}
                    {{ $modsToolsCount = add $modsToolsCount 1 }}
                {{ end }}
            {{ end }}

            <!-- Navigation Tabs -->
            <div class="tabs">
                <button class="tab-btn active" data-category="games">
                    üéÆ {{ i18n "games" | default "Jeux" }}
                    <span class="count">{{ $gamesCount }}</span>
                </button>
                <button class="tab-btn" data-category="apps-web">
                    üíª {{ i18n "apps_web" | default "Apps/Web" }}
                    <span class="count">{{ $appsWebCount }}</span>
                </button>
                <button class="tab-btn" data-category="mods-tools">
                    üõ†Ô∏è {{ i18n "mods_tools" | default "Mods & Tools" }}
                    <span class="count">{{ $modsToolsCount }}</span>
                </button>
            </div>

            <!-- Description Text -->
            <div class="projects-description">
                <p id="section-description">{{ i18n "projects_description" | default "D√©couvrez mes projets organis√©s par secteur d'expertise : jeux vid√©o, applications web et outils de d√©veloppement." }}</p>
            </div>

            <!-- Projects Grids - One per category -->
            {{/* Games Grid */}}
            <div class="projects-grid active" data-category="games">
                {{ range where $.Site.RegularPages "Section" "projects" }}
                    {{ if hasPrefix .Params.sector "games" }}
                        {{- $projectImage := .Params.background_image | default .Params.image | default "images/placeholder-project.jpg" -}}
                        {{ partial "project-card-unified.html" (dict 
                            "title" .Title
                            "subtitle" .Params.subtitle
                            "description" .Params.description
                            "image" $projectImage
                            "url" .Permalink
                            "status" (cond (eq .Params.status "completed") "Termin√©" (cond (eq .Params.status "in-progress") "En cours" ""))
                        ) }}
                    {{ end }}
                {{ end }}
            </div>

            {{/* Apps/Web Grid */}}
            <div class="projects-grid" data-category="apps-web" hidden>
                {{ range where $.Site.RegularPages "Section" "projects" }}
                    {{ if hasPrefix .Params.sector "appsweb" }}
                        {{- $projectImage := .Params.background_image | default .Params.image | default "images/placeholder-project.jpg" -}}
                        {{ partial "project-card-unified.html" (dict 
                            "title" .Title
                            "subtitle" .Params.subtitle
                            "description" .Params.description
                            "image" $projectImage
                            "url" .Permalink
                            "status" (cond (eq .Params.status "completed") "Termin√©" (cond (eq .Params.status "in-progress") "En cours" ""))
                        ) }}
                    {{ end }}
                {{ end }}
            </div>

            {{/* Mods & Tools Grid */}}
            <div class="projects-grid" data-category="mods-tools" hidden>
                {{ range where $.Site.RegularPages "Section" "projects" }}
                    {{ if or (eq .Params.sector "mods") (eq .Params.sector "tools") }}
                        {{- $projectImage := .Params.background_image | default .Params.image | default "images/placeholder-project.jpg" -}}
                        {{ partial "project-card-unified.html" (dict 
                            "title" .Title
                            "subtitle" .Params.subtitle
                            "description" .Params.description
                            "image" $projectImage
                            "url" .Permalink
                            "status" (cond (eq .Params.status "completed") "Termin√©" (cond (eq .Params.status "in-progress") "En cours" ""))
                        ) }}
                    {{ end }}
                {{ end }}
            </div>
        </section>
    </main>
</div>

<!-- Auto-include person modal if needed -->
{{ partial "auto-person-modal.html" . }}

{{ end }}
