{{ define "main" }}
<!-- Project Hero Section -->
{{ if .Params.image }}
<style>
    body {
        --hero-bg-image: url('{{ .Params.image }}');
    }
</style>
<script>
    // Ajouter la classe project-page au body pour gérer les z-index des canvas
    document.body.classList.add('project-page');
</script>
{{ end }}
<!-- Fixed Background Overlay -->
<div class="project-hero-overlay"></div>
<section class="project-hero">
    <div class="project-hero-content no-top">
        <!-- Project Info Block centré -->
        <div class="project-hero-bottom">
            <div class="project-info-grid">
                <!-- Left: Project Description Block -->
                <div class="project-description-block">
                    {{ if .Params.logo }}
                    <div class="project-logo-bottom">
                        <img src="{{ .Params.logo }}" alt="{{ .Title }}" class="project-logo-img">
                    </div>
                    {{ else }}
                    <h2 class="project-name-bottom">{{ .Title }}</h2>
                    {{ end }}
                    
                    <!-- Project Action Buttons -->
                    {{ if .Params.actions }}
                    <div class="project-actions">
                        {{ $actionsCount := len .Params.actions }}
                        {{ if le $actionsCount 2 }}
                            <!-- Afficher toutes les actions si 2 ou moins -->
                            {{ range .Params.actions }}
                            <a href="{{ .url }}" {{ if ne .url "#" }}target="_blank"{{ end }} class="btn-action {{ if .primary }}primary{{ end }}">
                                {{ if eq .icon "steam" }}
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C7.4,22 3.6,18.6 2.3,14L6.2,15.3C6.5,16.9 7.9,18 9.5,18C11.4,18 13,16.4 13,14.5C13,14.2 13,13.9 12.9,13.6L16.5,11C18.2,11 19.5,9.7 19.5,8S18.2,5 16.5,5S13.5,6.3 13.5,8V8.1L11,11.6C10.6,11.5 10.1,11.5 9.5,11.5C8.1,11.5 6.8,12.1 6,13.1L2,12C2,6.5 6.5,2 12,2M16.5,6.5A1.5,1.5 0 0,1 18,8A1.5,1.5 0 0,1 16.5,9.5A1.5,1.5 0 0,1 15,8A1.5,1.5 0 0,1 16.5,6.5M9.5,13A1.5,1.5 0 0,1 11,14.5A1.5,1.5 0 0,1 9.5,16A1.5,1.5 0 0,1 8,14.5A1.5,1.5 0 0,1 9.5,13Z" />
                                </svg>
                                {{ else if eq .icon "youtube" }}
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M10,15L15.19,12L10,9V15M21.56,7.17C21.69,7.64 21.78,8.27 21.84,9.07C21.91,9.87 21.94,10.56 21.94,11.16L22,12C22,14.19 21.84,15.8 21.56,16.83C21.31,17.73 20.73,18.31 19.83,18.56C19.36,18.69 18.5,18.78 17.18,18.84C15.88,18.91 14.69,18.94 13.59,18.94L12,19C7.81,19 5.2,18.84 4.17,18.56C3.27,18.31 2.69,17.73 2.44,16.83C2.31,16.36 2.22,15.73 2.16,14.93C2.09,14.13 2.06,13.44 2.06,12.84L2,12C2,9.81 2.16,8.2 2.44,7.17C2.69,6.27 3.27,5.69 4.17,5.44C4.64,5.31 5.5,5.22 6.82,5.16C8.12,5.09 9.31,5.06 10.41,5.06L12,5C16.19,5 18.8,5.16 19.83,5.44C20.73,5.69 21.31,6.27 21.56,7.17Z" />
                                </svg>
                                {{ else if eq .icon "github" }}
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z" />
                                </svg>
                                {{ else if eq .icon "download" }}
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z" />
                                </svg>
                                {{ else if eq .icon "external" }}
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z" />
                                </svg>
                                {{ end }}
                                {{ .label }}
                            </a>
                            {{ end }}
                        {{ else }}
                            <!-- Afficher les 2 premières actions + bouton ... -->
                            {{ range first 2 .Params.actions }}
                            {{ if eq .icon "youtube" }}
                            <button class="btn-action {{ if .primary }}primary{{ end }}" onclick="handleYouTubeAction('{{ .url }}', '{{ .label }}');">
                            {{ else }}
                            <a href="{{ .url }}" {{ if ne .url "#" }}target="_blank"{{ end }} class="btn-action {{ if .primary }}primary{{ end }}">
                            {{ end }}
                                {{ if eq .icon "steam" }}
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C7.4,22 3.6,18.6 2.3,14L6.2,15.3C6.5,16.9 7.9,18 9.5,18C11.4,18 13,16.4 13,14.5C13,14.2 13,13.9 12.9,13.6L16.5,11C18.2,11 19.5,9.7 19.5,8S18.2,5 16.5,5S13.5,6.3 13.5,8V8.1L11,11.6C10.6,11.5 10.1,11.5 9.5,11.5C8.1,11.5 6.8,12.1 6,13.1L2,12C2,6.5 6.5,2 12,2M16.5,6.5A1.5,1.5 0 0,1 18,8A1.5,1.5 0 0,1 16.5,9.5A1.5,1.5 0 0,1 15,8A1.5,1.5 0 0,1 16.5,6.5M9.5,13A1.5,1.5 0 0,1 11,14.5A1.5,1.5 0 0,1 9.5,16A1.5,1.5 0 0,1 8,14.5A1.5,1.5 0 0,1 9.5,13Z" />
                                </svg>
                                {{ else if eq .icon "youtube" }}
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M10,15L15.19,12L10,9V15M21.56,7.17C21.69,7.64 21.78,8.27 21.84,9.07C21.91,9.87 21.94,10.56 21.94,11.16L22,12C22,14.19 21.84,15.8 21.56,16.83C21.31,17.73 20.73,18.31 19.83,18.56C19.36,18.69 18.5,18.78 17.18,18.84C15.88,18.91 14.69,18.94 13.59,18.94L12,19C7.81,19 5.2,18.84 4.17,18.56C3.27,18.31 2.69,17.73 2.44,16.83C2.31,16.36 2.22,15.73 2.16,14.93C2.09,14.13 2.06,13.44 2.06,12.84L2,12C2,9.81 2.16,8.2 2.44,7.17C2.69,6.27 3.27,5.69 4.17,5.44C4.64,5.31 5.5,5.22 6.82,5.16C8.12,5.09 9.31,5.06 10.41,5.06L12,5C16.19,5 18.8,5.16 19.83,5.44C20.73,5.69 21.31,6.27 21.56,7.17Z" />
                                </svg>
                                {{ else if eq .icon "github" }}
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z" />
                                </svg>
                                {{ else if eq .icon "download" }}
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z" />
                                </svg>
                                {{ else if eq .icon "external" }}
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z" />
                                </svg>
                                {{ end }}
                                {{ .label }}
                            {{ if eq .icon "youtube" }}
                            </button>
                            {{ else }}
                            </a>
                            {{ end }}
                            {{ end }}
                            <!-- Bouton ... for more options -->
                            <button class="btn-action-icon" onclick="showMoreActions(this);">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <circle cx="5" cy="12" r="2"/>
                                    <circle cx="12" cy="12" r="2"/>
                                    <circle cx="19" cy="12" r="2"/>
                                </svg>
                            </button>
                            <!-- Popup des actions cachées -->
                            <div class="actions-popup" style="display: none;">
                                <div class="popup-overlay" onclick="hideMoreActions(this)"></div>
                                <div class="popup-content">
                                    <div class="popup-header">
                                        <h3>{{ i18n "more_options" | default "Plus d'options" }}</h3>
                                        <button class="popup-close" onclick="hideMoreActions(this)">
                                            <svg viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" />
                                            </svg>
                                        </button>
                                    </div>
                                    <div class="popup-actions">
                                        {{ range after 2 .Params.actions }}
                                        {{ if eq .icon "youtube" }}
                                        <div class="popup-action-item youtube-action" onclick="handleYouTubeAction('{{ .url }}', '{{ .label }}'); hideMoreActions(this);">
                                        {{ else }}
                                        <a href="{{ .url }}" {{ if ne .url "#" }}target="_blank"{{ end }} class="popup-action-item">
                                        {{ end }}
                                            <div class="action-icon">
                                                {{ if eq .icon "steam" }}
                                                <svg viewBox="0 0 24 24" fill="currentColor">
                                                    <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C7.4,22 3.6,18.6 2.3,14L6.2,15.3C6.5,16.9 7.9,18 9.5,18C11.4,18 13,16.4 13,14.5C13,14.2 13,13.9 12.9,13.6L16.5,11C18.2,11 19.5,9.7 19.5,8S18.2,5 16.5,5S13.5,6.3 13.5,8V8.1L11,11.6C10.6,11.5 10.1,11.5 9.5,11.5C8.1,11.5 6.8,12.1 6,13.1L2,12C2,6.5 6.5,2 12,2M16.5,6.5A1.5,1.5 0 0,1 18,8A1.5,1.5 0 0,1 16.5,9.5A1.5,1.5 0 0,1 15,8A1.5,1.5 0 0,1 16.5,6.5M9.5,13A1.5,1.5 0 0,1 11,14.5A1.5,1.5 0 0,1 9.5,16A1.5,1.5 0 0,1 8,14.5A1.5,1.5 0 0,1 9.5,13Z" />
                                                </svg>
                                                {{ else if eq .icon "youtube" }}
                                                <svg viewBox="0 0 24 24" fill="currentColor">
                                                    <path d="M10,15L15.19,12L10,9V15M21.56,7.17C21.69,7.64 21.78,8.27 21.84,9.07C21.91,9.87 21.94,10.56 21.94,11.16L22,12C22,14.19 21.84,15.8 21.56,16.83C21.31,17.73 20.73,18.31 19.83,18.56C19.36,18.69 18.5,18.78 17.18,18.84C15.88,18.91 14.69,18.94 13.59,18.94L12,19C7.81,19 5.2,18.84 4.17,18.56C3.27,18.31 2.69,17.73 2.44,16.83C2.31,16.36 2.22,15.73 2.16,14.93C2.09,14.13 2.06,13.44 2.06,12.84L2,12C2,9.81 2.16,8.2 2.44,7.17C2.69,6.27 3.27,5.69 4.17,5.44C4.64,5.31 5.5,5.22 6.82,5.16C8.12,5.09 9.31,5.06 10.41,5.06L12,5C16.19,5 18.8,5.16 19.83,5.44C20.73,5.69 21.31,6.27 21.56,7.17Z" />
                                                </svg>
                                                {{ else if eq .icon "github" }}
                                                <svg viewBox="0 0 24 24" fill="currentColor">
                                                    <path d="M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z" />
                                                </svg>
                                                {{ else if eq .icon "download" }}
                                                <svg viewBox="0 0 24 24" fill="currentColor">
                                                    <path d="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z" />
                                                </svg>
                                                {{ else if eq .icon "external" }}
                                                <svg viewBox="0 0 24 24" fill="currentColor">
                                                    <path d="M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z" />
                                                </svg>
                                                {{ end }}
                                            </div>
                                            <div class="action-content">
                                                <div class="action-label">{{ .label }}</div>
                                                <div class="action-type">{{ .type | title }}</div>
                                            </div>
                                        {{ if eq .icon "youtube" }}
                                        </div>
                                        {{ else }}
                                        </a>
                                        {{ end }}
                                        {{ end }}
                                    </div>
                                </div>
                            </div>
                        {{ end }}
                    </div>
                    {{ end }}
                    
                    <div class="description-content">
                        <h3 class="description-title">{{ i18n "project_information" | default "Informations du projet" }}</h3>
                        
                        <!-- Meta Information -->
                        <div class="project-meta-bottom">
                            <div class="meta-item-bottom">
                                <span class="meta-label-bottom">{{ i18n "date" | default "Date" }}</span>
                                <span class="meta-value-bottom">{{ .Date.Format (.Site.Data.config.blog.dateFormat | default "Jan 2006") }}</span>
                            </div>
                            
                            {{ if .Params.status }}
                            <div class="meta-item-bottom">
                                <span class="meta-label-bottom">{{ i18n "status" | default "Statut" }}</span>
                                <span class="meta-value-bottom status-{{ .Params.status | lower }}">{{ .Params.status }}</span>
                            </div>
                            {{ end }}
                            
                            {{ if .Params.sector }}
                            <div class="meta-item-bottom">
                                <span class="meta-label-bottom">{{ i18n "sector" | default "Secteur" }}</span>
                                <span class="meta-value-bottom">{{ .Params.sector }}</span>
                            </div>
                            {{ end }}
                            
                            {{ if .Params.link }}
                            <div class="meta-item-bottom">
                                <a href="{{ .Params.link }}" target="_blank" class="project-link-bottom">
                                    {{ i18n "see_project" | default "Voir le projet" }} <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z" />
                                    </svg>
                                </a>
                            </div>
                            {{ end }}
                        </div>
                        
                        <!-- Technologies Pills -->
                        {{ partial "project-technologies-detailed.html" . }}
                    </div>
                </div>
                
                <!-- Right: Notable Facts -->
                {{ if .Params.notable_facts }}
                <div class="project-notable-facts-hero">
                    <div class="notable-facts-content">
                        <h3 class="notable-facts-title-hero">{{ i18n "notable_facts" | default "Faits notables" }}</h3>
                        {{ range .Params.notable_facts }}
                        <div class="fact-card-hero">
                            <div class="fact-icon-hero {{ .type }}">{{ .icon }}</div>
                            <div class="fact-content-hero">
                                <div class="fact-value-hero">{{ .value | safeHTML }}</div>
                                <div class="fact-label-hero">{{ .label }}</div>
                            </div>
                        </div>
                        {{ end }}
                    </div>
                </div>
                {{ end }}
            </div>
        </div>
        </div>
    </div>
    
    <!-- Scroll Indicator -->
    <div class="scroll-indicator">
        <div class="scroll-arrow"></div>
    </div>
</section>

<!-- Project Info Boxes Section - Section distincte avant le contenu -->
{{ $showPortfolioWidgets := true }}
{{ if or .Params.contributors .Params.development_time .Params.gallery .Params.galleries .Params.youtube_videos .Params.youtube_galleries .Params.youtube_singles .Params.programming_languages .Params.frameworks_engines .Params.technical_specs .Params.awards $showPortfolioWidgets }}
<section class="project-widgets-section">
    <div class="project-widgets-wrapper">
    <div class="project-widgets">
            <!-- Contributors Box -->
            {{ partial "projects/widgets/contributors.html" . }}

            <!-- Development Time Box -->
            {{ partial "projects/widgets/development-time.html" . }}

            <!-- Project Gallery Box -->
            {{ partial "projects/widgets/gallery.html" . }}

            <!-- Technical Specifications Box -->
            {{ partial "projects/widgets/technical-specs.html" . }}
        
            <!-- Mes Spécialités utilisées dans ce projet -->
            {{ partial "projects/widgets/specialties.html" . }}

            <!-- Mes Outils utilisés dans ce projet -->
            {{ partial "projects/widgets/tools.html" . }}

            <!-- Awards/Recognition Box -->
            {{ partial "projects/widgets/awards.html" . }}

            <!-- Testimonials Box -->
            {{ partial "projects/widgets/testimonials.html" . }}

            <!-- YouTube Videos Box -->
            {{ partial "projects/widgets/youtube-videos.html" . }}

            <!-- YouTube Single Videos Boxes -->
            {{- range .Params.youtube_singles -}}
              {{ partial "projects/widgets/youtube-single.html" (dict "video" . "context" $) }}
            {{- end -}}

            <!-- Clients Box -->
            {{ partial "projects/widgets/clients.html" . }}

            <!-- Grade Box -->
            {{ partial "projects/widgets/grade.html" . }}

            <!-- Downloads Box -->
            {{ partial "projects/widgets/downloads.html" . }}
           
            <!-- Ranking Box -->
            {{ partial "projects/widgets/ranking.html" . }}
    
            <!-- Multiple Galleries Boxes -->
            {{ range $galleryIndex, $gallery := .Params.galleries }}
            <div class="project-widget gallery-box multiple-gallery-{{ $galleryIndex }} {{ $gallery.size | default "size-large" }}{{ if eq $gallery.gallery_aspect "16:9" }} gallery-16x9{{ end }}" onclick="toggleInfoBox(this)">
                <!-- Gallery Preview Background pour l'état fermé -->
                <div class="gallery-preview gallery-background"
                     style="--count: {{ len $gallery.images }}; background-image: url('{{ (index $gallery.images 0).url }}'); background-size: cover; background-position: center;">
                    <div class="gallery-carousel">
                        {{ range $idx, $img := $gallery.images }}
                        <div class="gallery-mini-item" style="--i: {{$idx}};">
                            <img src="{{ $img.url }}" alt="{{ $img.caption }}" loading="lazy">
                        </div>
                        {{ end }}
                    </div>
                </div>
                
                <div class="project-widget-header">
                    <div class="project-widget-icon gallery">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z"/>
                        </svg>
                    </div>
                    <div class="project-widget-header-content">
                        <h3 class="project-widget-title">{{ $gallery.title | default "Galerie d'images" }}</h3>
                        <div class="project-widget-summary">{{ len $gallery.images }} image{{ if gt (len $gallery.images) 1 }}s{{ end }}</div>
                        {{ if $gallery.description }}
                        <div class="project-widget-description">{{ $gallery.description }}</div>
                        {{ end }}
                    </div>
                    <div class="project-widget-toggle">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"/>
                        </svg>
                    </div>
                </div>
                <div class="project-widget-content">
                    {{/* Contenu modal enhanced - uniquement ce qui doit apparaître dans le modal */}}
                    {{ partial "projects/widgets/modal/gallery.html" (dict "gallery" $gallery.images "projectId" $.File.BaseFileName) }}
                </div>
            </div>
            {{ end }}

    </div>
</section>

<!-- Modal pour les vidéos YouTube -->
<div id="youtubeModal" class="youtube-modal" onclick="closeYouTubeModal()">
    <div class="youtube-modal-content" onclick="event.stopPropagation()">
        <button class="youtube-modal-close" onclick="closeYouTubeModal()" title="Fermer la vidéo">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" />
            </svg>
        </button>
        <div class="youtube-modal-loading">Chargement...</div>
        <iframe id="youtubeIframe" src="" frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen>
        </iframe>
    </div>
</div>

{{ end }}

<!-- Project Content (seulement si le projet a du contenu markdown) -->
{{ if .Content }}
{{ $trimmedContent := trim .Content " \n\r\t" }}
{{ if $trimmedContent }}
<div class="blog-theme blog-single-page">
    <!-- Conteneur principal avec layout 2 colonnes -->
    <div class="project-content-layout">
        <!-- Colonne principale : Article -->
        <main class="blog-article-content project-main-content">
            <div class="blog-content-wrapper">
                {{ .Content }}
            </div>
        </main>
        
        <!-- Colonne droite : Sidebar avec faits notables -->
        {{ if .Params.notable_facts }}
        <aside class="project-sidebar">
            <div class="notable-facts">
                <h3 class="notable-facts-title">Faits notables</h3>
                {{ range .Params.notable_facts }}
                <div class="fact-card">
                    <div class="fact-icon {{ .type }}">{{ .icon }}</div>
                    <div class="fact-value">{{ .value | safeHTML }}</div>
                    <div class="fact-label">{{ .label }}</div>
                </div>
                {{ end }}
            </div>
        </aside>
        {{ end }}
    </div>
    
    </div>
{{ end }}
{{ end }}

<!-- Navigation entre projets (toujours visible) -->
<nav class="blog-post-navigation">
    {{ with .PrevInSection }}
    <div class="blog-nav-item blog-nav-prev">
        <span class="blog-nav-label">{{ i18n "previous_project" | default "Projet précédent" }}</span>
        <a href="{{ .Permalink }}" class="blog-nav-link">
            <h4>{{ .Title }}</h4>
            {{ if .Params.period_start }}
            <time>{{ .Params.period_start }}</time>
            {{ else if .Date }}
            <time>{{ .Date.Format "02 Jan 2006" }}</time>
            {{ end }}
        </a>
    </div>
    {{ end }}

    {{ with .NextInSection }}
    <div class="blog-nav-item blog-nav-next">
        <span class="blog-nav-label">{{ i18n "next_project" | default "Projet suivant" }}</span>
        <a href="{{ .Permalink }}" class="blog-nav-link">
            <h4>{{ .Title }}</h4>
            {{ if .Params.period_start }}
            <time>{{ .Params.period_start }}</time>
            {{ else if .Date }}
            <time>{{ .Date.Format "02 Jan 2006" }}</time>
            {{ end }}
        </a>
    </div>
    {{ end }}
</nav>

<!-- Image Modal for Gallery -->
<div id="imageModal" class="image-modal" onclick="closeImageModal()" style="z-index: 999999 !important;">
    <div class="image-modal-content">
        <span class="image-modal-close" onclick="closeImageModal()" style="z-index: 1000000 !important;">&times;</span>
        <img id="modalImage" src="" alt="">
        <div id="modalCaption" class="image-modal-caption"></div>
    </div>
</div>

<script>
function showMoreActions(button) {
    const popup = button.nextElementSibling;
    if (popup && popup.classList.contains('actions-popup')) {
        popup.style.display = 'block';
        setTimeout(() => popup.classList.add('active'), 10);
    }
}

function hideMoreActions(element) {
    const popup = element.closest('.actions-popup');
    if (popup) {
        popup.classList.remove('active');
        setTimeout(() => popup.style.display = 'none', 300);
    }
}

function initializeInfoBoxSystem() {
    const infoBoxes = document.querySelectorAll('.project-widget');
    
    infoBoxes.forEach(function(infoBox) {
        // Stocker la taille originale de chaque widget
        const computedStyle = window.getComputedStyle(infoBox);
        const gridColumn = computedStyle.gridColumn;
        
        infoBox.setAttribute('data-original-span', gridColumn);
        infoBox.style.setProperty('--original-span', gridColumn);
        
        // Ajouter des gestionnaires d'événements pour les transitions
        infoBox.addEventListener('transitionstart', function(e) {
            if (e.propertyName === 'grid-column') {
                // Marquer le début de la transition de grille
                infoBox.classList.add('transitioning');
            }
        });
        
        infoBox.addEventListener('transitionend', function(e) {
            if (e.propertyName === 'grid-column') {
                // Marquer la fin de la transition de grille
                infoBox.classList.remove('transitioning');
            }
        });
        
        // Optimisation pour les performances : observer les changements de taille
        if (window.ResizeObserver) {
            const resizeObserver = new ResizeObserver(function(entries) {
                entries.forEach(function(entry) {
                    // Assurer que le widget maintient ses proportions
                    if (entry.target.classList.contains('expanded')) {
                        entry.target.style.minHeight = 'auto';
                    }
                });
            });
            
            resizeObserver.observe(infoBox);
        }
    });
    
    // Gestionnaire global pour éviter les conflits entre widgets
    let currentlyExpanding = null;
    
    window.addEventListener('click', function(e) {
    const header = e.target.closest('.project-widget-header');
        if (header && currentlyExpanding === null) {
            const infoBox = header.closest('.project-widget');
            if (infoBox.classList.contains('expanding') || infoBox.classList.contains('collapsing')) {
                return; // Ignorer si déjà en cours d'animation
            }
            
            currentlyExpanding = infoBox;
            setTimeout(() => {
                currentlyExpanding = null;
            }, 500); // Délai de sécurité pour éviter les clics rapides
        }
    });
}

function toggleInfoBox(header) {
    const infoBox = header.closest('.project-widget');
    if (!infoBox) return;

    // Nouvel objectif : ouvrir en modal plein écran si UnifiedModal disponible
    if (window.UnifiedModal && typeof window.UnifiedModal.openProjectWidget === 'function') {
        window.UnifiedModal.openProjectWidget(infoBox);
        return;
    }

    // Fallback legacy (ancien comportement expand/collapse) si le système unifié n'est pas chargé
    const isExpanded = infoBox.classList.contains('expanded');
    infoBox.classList.toggle('expanded', !isExpanded);
}

function openImageModal(imageUrl, caption) {
    const modal = document.getElementById('imageModal');
    const modalImage = document.getElementById('modalImage');
    const modalCaption = document.getElementById('modalCaption');
    
    // Pause all testimonials before showing modal
    if (typeof window.pauseAllTestimonials === 'function') {
        window.pauseAllTestimonials();
    }
    
    modalImage.src = imageUrl;
    modalCaption.textContent = caption || '';
    modal.style.display = 'flex';
    
    // Prevent body scroll
    document.body.style.overflow = 'hidden';
    
    // Add animation
    setTimeout(() => modal.classList.add('active'), 10);
}

function closeImageModal() {
    const modal = document.getElementById('imageModal');
    modal.classList.remove('active');
    
    // Resume all testimonials when closing modal
    if (typeof window.resumeAllTestimonials === 'function') {
        window.resumeAllTestimonials();
    }
    
    setTimeout(() => {
        modal.style.display = 'none';
        
        // Check if other modals are still open before restoring body scroll
        try {
            const modalIds = ['unifiedModal', 'skillModal', 'personModal'];
            const anyModalOpen = modalIds.some(id => {
                const el = document.getElementById(id);
                if (!el) return false;
                const display = (el.style && el.style.display) ? el.style.display : window.getComputedStyle(el).display;
                return display && display !== 'none';
            });
            
            // Only restore scroll if no other modals are open
            document.body.style.overflow = anyModalOpen ? 'hidden' : 'auto';
        } catch(e) {
            // Fallback: restore scroll if there's an error
            document.body.style.overflow = 'auto';
        }
    }, 300);
}

// Close modal with Escape key
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        closeImageModal();
    }
});

// Enhanced blur transition effect
document.addEventListener('DOMContentLoaded', function() {
    const body = document.body;
    
    // Initialisation du système de widgets amélioré
    initializeInfoBoxSystem();
    
    // Smart gallery slideshow with reusable class
    const galleryBoxes = document.querySelectorAll('.gallery-box:not(.expanded)');
    
    galleryBoxes.forEach(function(galleryBox, index) {
        // Add unique temporary ID for selector
        const uniqueId = `gallery-slideshow-${index}`;
        galleryBox.id = uniqueId;
        
        // Initialize slideshow with our centralized class
        const slideshow = new GallerySlideshow(`#${uniqueId}`, {
            interval: 4000,
            transitionDuration: 1000,
            preloadAll: true,
            pauseWhenExpanded: true
        });
    });
    
    // Trigger blur animation after page load
    setTimeout(() => {
        body.classList.add('blur-animated');
    }, 300);
    
    // Smooth scroll-based blur intensity adjustment
    let ticking = false;
    
    function updateBlur() {
        const scrollY = window.pageYOffset;
        const heroHeight = document.querySelector('.project-hero').offsetHeight;
        const maxScroll = heroHeight * 0.8;
        
        // Calculate blur intensity based on scroll position
        const blurProgress = Math.min(scrollY / maxScroll, 1);
        const blurValue = 8 + (blurProgress * 4); // 8px to 12px
        
        document.documentElement.style.setProperty('--blur-intensity', `${blurValue}px`);
        ticking = false;
    }
    
    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(updateBlur);
            ticking = true;
        }
    }
    
    window.addEventListener('scroll', requestTick, { passive: true });
    
    // Initial call
    updateBlur();
});
</script>

<!-- Technical Specifications Enhancement Script -->
{{ $techSpecsJs := resources.Get "js/technical-specs.js" }}
{{ if $techSpecsJs }}
<script>{{ $techSpecsJs.Content | safeJS }}</script>
{{ end }}

<!-- Auto-include person modal if needed -->
{{ partial "auto-person-modal.html" . }}

<!-- Include skill modal for specialties and tools -->
{{ partial "skill-modal.html" . }}
{{ end }}
