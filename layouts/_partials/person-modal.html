{{/* Modal for displaying person details - Glassmorphism Design */}}
<div id="personModal" class="person-modal" style="display: none;">
    <div class="person-modal-backdrop" onclick="closePersonModal()"></div>
    <div class="person-modal-content">
        <button class="person-modal-close" onclick="closePersonModal()">&times;</button>
        
        <div class="person-modal-body">
            <!-- Header avec profil -->
            <div class="person-modal-profile-section">
                <div class="person-modal-profile-content">
                    <div class="person-modal-avatar-container">
                        <div class="person-modal-avatar-large" id="personAvatarLarge">
                            <img id="modalPersonAvatar" src="" alt="">
                        </div>
                    </div>
                    
                    <div class="person-modal-identity">
                        <h2 id="modalPersonName" class="person-modal-name"></h2>
                        <div class="person-modal-position-info">
                            <div class="position-and-company">
                                <span class="position-chip" id="modalPersonPosition"></span>
                                <span class="company-chip" id="modalPersonCompany"></span>
                            </div>
                            <div class="person-modal-contact-buttons" id="personModalContactButtons">
                                <!-- Contact buttons (LinkedIn, GitHub, website, email, discord) -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Testimonials section - pleine largeur dans le header -->
                <div id="modalPersonTestimonials" class="person-modal-testimonials-full-width">
                    <!-- Testimonials will be inserted here -->
                </div>
            </div>

            <!-- Navigation moderne avec sÃ©parateur -->
            <div class="person-modal-navigation">
                <nav class="person-modal-nav-tabs" role="tablist">
                    <button class="nav-tab active" role="tab" aria-selected="true" aria-controls="personModalTabBio" data-tab="bio">
                        <span class="nav-tab-icon">ðŸ‘¤</span>
                        <span class="nav-tab-label">Biographie</span>
                    </button>
                    <button class="nav-tab" role="tab" aria-selected="false" aria-controls="personModalTabProjects" data-tab="projects">
                        <span class="nav-tab-icon">ðŸš€</span>
                        <span class="nav-tab-label">Projets</span>
                    </button>
                </nav>
            </div>

            <!-- Contenu avec padding amÃ©liorÃ© -->
            <div class="person-modal-content-area">
                <div class="content-panel active" id="personModalTabBio" role="tabpanel" aria-labelledby="personModalTabBtnBio">
                    <div class="bio-container">
                        <div id="modalPersonBio" class="bio-content">
                            <!-- Person biography and details -->
                        </div>
                    </div>
                </div>
                <div class="content-panel" id="personModalTabProjects" role="tabpanel" aria-labelledby="personModalTabBtnProjects" hidden>
                    <div class="projects-container">
                        <div id="modalPersonProjects" class="projects-content">
                            <!-- Person projects will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


{{/* Integrate person data into the page to avoid API requests */}}
<script>
window.portfolioPeople = [
    {{- range where .Site.RegularPages "Section" "people" -}}
        {
            id: "{{ .Params.id }}",
            name: "{{ .Title }}",
            avatar: "{{ .Params.avatar }}",
            position: "{{ .Params.position }}",
            company: "{{ .Params.company }}",
            bio: "{{ .Params.bio }}",
            email: "{{ .Params.email }}",
            linkedin: "{{ .Params.linkedin }}",
            github: "{{ .Params.github }}",
            discord: "{{ .Params.discord }}",
            website: "{{ .Params.website }}",
            url: "{{ .RelPermalink }}",
            content: "{{ .Content }}"
        },
    {{- end -}}
];

window.portfolioTestimonials = [
    {{- range .Site.Data.testimonials -}}
    {
        personId: "{{ .personId }}",
        company: "{{ .company }}",
        position: "{{ .position }}",
        text: {{ .text | jsonify }}
    },
    {{- end -}}
];

// Ensure portfolioProjects exists with contributors data
// If not loaded by skill-modal, create it here
if (!window.portfolioProjects) {
    console.log('Creating portfolioProjects data as fallback...');
    window.portfolioProjects = [
        {{- range where .Site.RegularPages "Section" "projects" -}}
            {{- $allTechnologies := partial "get-all-technologies.html" . -}}
            {
                title: {{ .Title | jsonify }},
                subtitle: {{ .Params.subtitle | jsonify }},
                description: {{ .Params.description | jsonify }},
                image: {{ .Params.image | jsonify }},
                status: {{ .Params.status | jsonify }},
                sector: {{ .Params.sector | jsonify }},
                featured: {{ .Params.featured | default false }},
                url: {{ .RelPermalink | jsonify }},
                year: {{ (.Params.year | default (.Date.Format "2006")) | jsonify }},
                technologies: {{ $allTechnologies | jsonify }},
                background_image: {{ (.Params.image | default "/images/placeholder-project.jpg") | jsonify }},
                github: {{ .Params.github | jsonify }},
                demo: {{ .Params.demo | jsonify }},
                website: {{ .Params.website | jsonify }},
                {{- if .Params.contributors -}}
                contributors: [
                    {{- range .Params.contributors -}}
                    {
                        person: "{{ .person }}",
                        role: "{{ .role }}"
                    },
                    {{- end -}}
                ],
                {{- else -}}
                contributors: [],
                {{- end -}}
                programming_languages: {{ .Params.programming_languages | jsonify }},
                frameworks_engines: {{ .Params.frameworks_engines | jsonify }},
                specialties: {{ .Params.specialties | jsonify }},
                tools: {{ .Params.tools | jsonify }}
            },
        {{- end -}}
    ];
    console.log('Fallback portfolioProjects created with', window.portfolioProjects.length, 'projects');
} else {
    console.log('portfolioProjects already exists, checking contributors data...');
    // Check if contributors data is present
    const projectsWithContributors = window.portfolioProjects.filter(p => p.contributors && p.contributors.length > 0);
    console.log('Projects with contributors:', projectsWithContributors.length);
    
    // If no contributors data, it means skill-modal loaded without contributors
    if (projectsWithContributors.length === 0) {
        console.log('No contributors data found, enriching existing data...');
        // We need to enrich the existing data with contributors info
        // This is more complex, so for now we'll log a warning
        console.warn('portfolioProjects exists but lacks contributors data. This may cause issues.');
    }
}

// Note: La logique du modal est maintenant dans person-modal-logic.js
console.log('=== PERSON MODAL DATA LOADING ===');
console.log('Load time:', new Date().toISOString());
console.log('Current page:', window.location.pathname);

// Function to check data availability
function checkPersonModalData() {
    console.log('--- Data availability check ---');
    console.log('window.portfolioProjects exists?', !!window.portfolioProjects);
    console.log('window.portfolioProjects type:', typeof window.portfolioProjects);
    console.log('window.portfolioProjects length:', window.portfolioProjects?.length || 'N/A');
    
    if (window.portfolioProjects && window.portfolioProjects.length > 0) {
        console.log('First project sample:', window.portfolioProjects[0]);
        console.log('Projects with contributors:');
        window.portfolioProjects.forEach((project, index) => {
            if (project.contributors && project.contributors.length > 0) {
                console.log(`  ${index + 1}. "${project.title}" - Contributors: ${project.contributors.map(c => c.person).join(', ')}`);
            }
        });
        
        // Test spÃ©cifique
        const testPersonId = 'francois-bertrand';
        const projectsForPerson = window.portfolioProjects.filter(project => 
            project.contributors && project.contributors.some(contributor => contributor.person === testPersonId)
        );
        console.log(`âœ… Test result - Projects for ${testPersonId}:`, projectsForPerson.length, projectsForPerson.map(p => p.title));
    } else {
        console.warn('âŒ No projects data available');
    }
}

// Check immediately
checkPersonModalData();

// Also check after a delay to see if data loads later
setTimeout(() => {
    console.log('=== DELAYED CHECK (1 second) ===');
    checkPersonModalData();
}, 1000);

// Make functions globally available for manual testing
window.checkPersonModalData = checkPersonModalData;

// Test function to manually open a person modal
window.testPersonModal = function(personId) {
    console.log('=== MANUAL TEST ===');
    console.log('Testing person modal for:', personId);
    checkPersonModalData();
    
    if (typeof window.openPersonModal === 'function') {
        window.openPersonModal(personId);
    } else {
        console.error('openPersonModal function not available');
    }
};

console.log('ðŸ’¡ Manual test commands:');
console.log('  - window.checkPersonModalData() : Check data availability');
console.log('  - window.testPersonModal("francois-bertrand") : Test modal for FranÃ§ois');
console.log('  - window.portfolioProjects : View projects data');
</script>
