<section class="projects-section">
    <div class="projects-header section-header-unified">
        <h2 class="section-title-unified">{{ i18n "projects_title" | default (i18n "projects") }}</h2>
        <p class="projects-subtitle section-subtitle-unified">{{ i18n "projects_subtitle" | default "Construire des applications utiles qui simplifient la vie." }}</p>
    </div>

    <!-- Navigation Tabs -->
    <div class="tabs">
        <button class="tab-btn active" data-category="games">üéÆ {{ i18n "games" | default "Jeux" }}</button>
        <button class="tab-btn" data-category="apps-web">üíª {{ i18n "apps_web" | default "Apps/Web" }}</button>
        <button class="tab-btn" data-category="mods-tools">üõ†Ô∏è {{ i18n "mods_tools" | default "Mods & Tools" }}</button>
    </div>

    <!-- Description Text -->
    <div class="projects-description">
    <p id="section-description">{{ i18n "projects_description" | default "D√©couvrez mes projets organis√©s par secteur d'expertise : jeux vid√©o, applications web et outils de d√©veloppement." }}</p>
    </div>

    <!-- Projects Grid -->
    <div class="projects-grid" id="projects-grid">
        {{/* Load categories configuration */}}
        {{ $categories := partial "project-categories-config.html" . }}
        
        {{/* Loop through each category and display its projects dynamically */}}
        {{ range $categoryKey, $config := $categories }}
            {{ range where $.Site.RegularPages "Section" "projects" }}
                {{ if .Params.featured }}
                    {{/* Dynamic filtering logic based on configuration */}}
                    {{ $shouldShow := false }}
                    
                    {{ if eq $categoryKey "games" }}
                        {{ if hasPrefix .Params.sector "games" }}{{ $shouldShow = true }}{{ end }}
                    {{ else if eq $categoryKey "apps-web" }}
                        {{ if hasPrefix .Params.sector "appsweb" }}{{ $shouldShow = true }}{{ end }}
                    {{ else if eq $categoryKey "mods-tools" }}
                        {{ if or (eq .Params.sector "mods") (eq .Params.sector "tools") }}{{ $shouldShow = true }}{{ end }}
                    {{ end }}
                    
                    {{/* Display tile if conditions are met */}}
                    {{ if $shouldShow }}
                        {{/* Get all technologies for this project */}}
                        {{ $allTechnologies := slice }}
                        {{ with .Params.programming_languages }}
                            {{ $allTechnologies = $allTechnologies | append . }}
                        {{ end }}
                        {{ with .Params.frameworks_engines }}
                            {{ $allTechnologies = $allTechnologies | append . }}
                        {{ end }}
                        {{ $allTechnologies = $allTechnologies | uniq }}
                        
                        <div data-project-id="{{ .File.BaseFileName }}"
                             data-background-image="{{ .Params.background_image | default .Params.image }}"
                             data-sector="{{ .Params.sector }}"
                             data-category="{{ $categoryKey }}"
                             data-technologies='{{ partial "combined-technologies.html" . }}'
                             {{ with $config.displayStyle }}style="{{ . }}"{{ end }}>
                            
                            {{ partial "project-card-unified.html" (dict 
                                "title" .Title
                                "subtitle" .Params.subtitle
                                "description" .Params.description
                                "image" (.Params.image | default "images/placeholder-project.jpg")
                                "url" .Permalink
                                "role" $config.icon
                                "status" (cond (eq .Params.status "completed") "Termin√©" (cond (eq .Params.status "in-progress") "En cours" ""))
                                "technologies" $allTechnologies
                                "maxTechnologies" 4
                            ) }}
                        </div>
                    {{ end }}
                {{ end }}
            {{ end }}
        {{ end }}
    </div>
    
    <!-- See All Projects Button -->
    <div class="projects-see-all">
        <a href="{{ "/projects/" | relLangURL }}" class="btn-action">
            <span>{{ i18n "see_all_projects" | default "Voir tous les projets" }}</span>
            {{- partial "icon.html" (dict "iconId" "arrow-right" "size" "18") -}}
        </a>
    </div>
</section>