<section class="experience-section">
    <div class="experience-header section-header-unified">
    <h2 class="section-title-unified">{{ i18n "experience_title" | default "Exp√©rience Professionnelle" }}</h2>
    <p class="experience-subtitle section-subtitle-unified">{{ i18n "experience_subtitle" | default "Mon parcours professionnel, des projets concrets aux comp√©tences d√©velopp√©es en entreprise" }}</p>
    </div>

    <!-- Navigation Tabs -->
    <div class="tabs">
        <button class="tab-btn active" data-tab="experiences">üíº {{ i18n "experiences" | default "Exp√©riences" }}</button>
        <button class="tab-btn" data-tab="internships">üè¢ {{ i18n "internships" | default "Stages & Recherche" }}</button>
    </div>

    <!-- Experiences Timeline -->
    <div class="experience-timeline" id="experiences-timeline" data-tab="experiences">
        {{ range $index, $exp := (.Site.GetPage "/experiences").Pages.ByParam "start_date" }}
        {{ $experienceData := partial "helpers/experience-data.html" $exp }}
        <div class="experience-card {{ if eq $experienceData.status "current" }}current{{ end }}">
            <div class="experience-header-card">
                <div class="company-info">
                    <div class="company-logo">
                        {{- $companyLogo := partial "get-optimized-image.html" (dict "imagePath" $exp.Params.logo "width" 200 "quality" 90) -}}
                        <img src="{{ $companyLogo.src }}" 
                             alt="{{ $exp.Params.company }}"
                             {{- if and $companyLogo.isResource (gt $companyLogo.width 0) }} width="{{ $companyLogo.width }}"{{ end -}}
                             {{- if and $companyLogo.isResource (gt $companyLogo.height 0) }} height="{{ $companyLogo.height }}"{{ end -}}
                             loading="lazy">
                    </div>
                    <div class="company-details">
                        <h3 class="job-title">{{ $exp.Title }}</h3>
                        <h4 class="company-name">{{ $exp.Params.company }}</h4>
                        <div class="job-meta">
                            <span class="job-period">{{ $experienceData.period }}</span>
                            <span class="job-duration">{{ $experienceData.duration }}</span>
                        </div>
                        <div class="job-info">
                            <span class="job-type">{{ $exp.Params.type }}</span>
                            <span class="job-location">üìç {{ $exp.Params.location }}</span>
                        </div>
                    </div>
                </div>
                {{ if eq $experienceData.status "current" }}
                <div class="current-badge">{{ i18n "in_progress" | default "En cours" }}</div>
                {{ else }}
                <div class="completed-badge">{{ i18n "completed" | default "Termin√©" }}</div>
                {{ end }}
            </div>

            <div class="experience-content">
                <p class="experience-description">{{ $exp.Params.description }}</p>

                {{ if $exp.Params.projects }}
                <div class="projects-section">
                    <div class="projects-header">
                        <h5>{{ i18n "main_projects" | default "Projets principaux :" }}</h5>
                    </div>
                    {{ $layout := $exp.Params.projects_layout | default "horizontal" }}
                    <div class="projects-container projects-container-{{ $layout }}" data-default-layout="{{ $layout }}">
                    {{ range $exp.Params.projects }}
                    <div class="project-item">
                        {{/* Handle project references */}}
                        {{ if .project_ref }}
                            {{/* Get project page - handle both slug and path formats */}}
                            {{ $projectPage := "" }}
                            {{ if hasPrefix .project_ref "/" }}
                                {{/* It's a Hugo path like /projects/my-game-showcase/ */}}
                                {{ $projectPage = $.Site.GetPage .project_ref }}
                            {{ else }}
                                {{/* It's just a slug like my-game-showcase */}}
                                {{ $projectPage = $.Site.GetPage (printf "/projects/%s" .project_ref) }}
                            {{ end }}
                            {{ if $projectPage }}
                                <!-- Project image from referenced project -->
                                <div class="project-tile-image">
                                    {{ if $projectPage.Params.image }}
                                        {{- $projectImg := partial "get-optimized-image.html" (dict "imagePath" $projectPage.Params.image "width" 600 "quality" 85) -}}
                                        <img src="{{ $projectImg.src }}" 
                                             alt="{{ $projectPage.Title }}"
                                             {{- if and $projectImg.isResource (gt $projectImg.width 0) }} width="{{ $projectImg.width }}"{{ end -}}
                                             {{- if and $projectImg.isResource (gt $projectImg.height 0) }} height="{{ $projectImg.height }}"{{ end -}}
                                             loading="lazy">
                                    {{ else }}
                                        {{- $placeholderImg := partial "get-optimized-image.html" (dict "imagePath" "images/placeholder-project.jpg" "width" 600 "quality" 85) -}}
                                        <img src="{{ $placeholderImg.src }}" 
                                             alt="{{ $projectPage.Title }}"
                                             {{- if and $placeholderImg.isResource (gt $placeholderImg.width 0) }} width="{{ $placeholderImg.width }}"{{ end -}}
                                             {{- if and $placeholderImg.isResource (gt $placeholderImg.height 0) }} height="{{ $placeholderImg.height }}"{{ end -}}
                                             loading="lazy">
                                    {{ end }}
                                    <div class="project-tile-overlay"></div>
                                </div>
                                
                                <!-- Default content (visible by default) -->
                                <div class="project-tile-content">
                                    <h6 class="project-name">{{ $projectPage.Title }}</h6>
                                    <p class="project-desc">{{ $projectPage.Params.description | default $projectPage.Params.subtitle }}</p>
                                </div>
                                
                                <!-- Detailed info (shown on hover) -->
                                <div class="project-tile-info">
                                    <div class="project-tile-info-content">
                                        <h6 class="project-name">{{ $projectPage.Title }}</h6>
                                        <p class="project-detailed-desc">
                                            {{ if .role_description }}{{ .role_description }}{{ else }}{{ $projectPage.Params.description }}{{ end }}
                                        </p>
                                        
                                        {{ $allTechnologies := partial "get-all-technologies.html" $projectPage }}
                                        {{ if $allTechnologies }}
                                        <div class="project-tile-tech">
                                            {{ range first 4 $allTechnologies }}
                                            <span class="project-tile-tech-item">{{ . }}</span>
                                            {{ end }}
                                            {{ if gt (len $allTechnologies) 4 }}
                                            <span class="project-tile-tech-item">+{{ sub (len $allTechnologies) 4 }}</span>
                                            {{ end }}
                                        </div>
                                        {{ end }}
                                        
                                        <!-- Project actions -->
                                        <div class="project-tile-actions">
                                            <a href="{{ $projectPage.RelPermalink }}" class="project-tile-btn">
                                                {{- partial "icon.html" (dict "iconId" "external-link" "size" "12") -}}
                                                {{ i18n "see_project" | default "Voir projet" }}
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            {{ else }}
                                <!-- Fallback if project not found -->
                                <div class="project-tile-content">
                                    <h6 class="project-name">{{ .project_ref }}</h6>
                                    <p class="project-desc">{{ i18n "project_not_found" | default "Projet r√©f√©renc√© non trouv√©" }}</p>
                                </div>
                            {{ end }}
                        {{ else }}
                            {{/* Handle inline project definition */}}
                            <!-- Project image (placeholder for inline projects) -->
                            <div class="project-tile-image">
                                {{- $inlineImg := partial "get-optimized-image.html" (dict "imagePath" (printf "/images/projects/%s/thumbnail.jpg" (lower (.name | urlize))) "width" 600 "quality" 85) -}}
                                <img src="{{ $inlineImg.src }}" 
                                     alt="{{ .name }}"
                                     {{- if and $inlineImg.isResource (gt $inlineImg.width 0) }} width="{{ $inlineImg.width }}"{{ end -}}
                                     {{- if and $inlineImg.isResource (gt $inlineImg.height 0) }} height="{{ $inlineImg.height }}"{{ end -}}
                                     loading="lazy">
                                <div class="project-tile-overlay"></div>
                            </div>
                            
                            <!-- Default content (visible by default) -->
                            <div class="project-tile-content">
                                <h6 class="project-name">{{ .name }}</h6>
                                <p class="project-desc">{{ .description }}</p>
                            </div>
                            
                            <!-- Detailed info (shown on hover) -->
                            <div class="project-tile-info">
                                <div class="project-tile-info-content">
                                    <h6 class="project-name">{{ .name }}</h6>
                                    <p class="project-detailed-desc">
                                        {{ if .role_description }}{{ .role_description }}{{ else }}{{ .description }}{{ end }}
                                    </p>
                                    
                                    {{ if .tasks }}
                                    <ul class="project-tasks">
                                        {{ range .tasks }}
                                        <li>{{ . }}</li>
                                        {{ end }}
                                    </ul>
                                    {{ end }}
                                    
                                    {{ $allTechnologies := partial "get-all-technologies.html" . }}
                                    {{ if $allTechnologies }}
                                    <div class="project-tile-tech">
                                        {{ range $allTechnologies }}
                                        <span class="project-tile-tech-item">{{ . }}</span>
                                        {{ end }}
                                    </div>
                                    {{ end }}
                                    
                                    <!-- Project actions -->
                                    <div class="project-tile-actions">
                                        {{ if .link }}
                                        <a href="{{ .link }}" class="project-tile-btn" target="_blank">
                                            {{- partial "icon.html" (dict "iconId" "external-link" "size" "12") -}}
                                            {{ i18n "see_project" | default "Voir projet" }}
                                        </a>
                                        {{ else }}
                                        <span class="project-tile-btn" style="opacity: 0.6;">
                                            {{- partial "icon.html" (dict "iconId" "external-link" "size" "12") -}}
                                            {{ i18n "confidential" | default "Confidentiel" }}
                                        </span>
                                        {{ end }}
                                    </div>
                                </div>
                            </div>
                        {{ end }}
                    </div>
                    {{ end }}
                    </div>
                </div>
                {{ else if $exp.Params.tasks }}
                <div class="tasks-section">
                    <h5>{{ i18n "responsibilities" | default "Responsabilit√©s :" }}</h5>
                    <ul class="experience-tasks">
                        {{ range $exp.Params.tasks }}
                        <li>{{ . }}</li>
                        {{ end }}
                    </ul>
                </div>
                {{ end }}

                <div class="experience-skills">
                    <h5>{{ i18n "technical_skills" | default "Comp√©tences techniques :" }}</h5>
                    <div class="skills-tags">
                        {{ range $exp.Params.programming_languages }}
                        {{ $skillName := . }}
                        {{ $found := false }}
                        {{ range $.Site.Data.programming_languages }}
                        {{ if eq .name $skillName }}
                        <span class="skill-tag clickable" 
                              onclick="openSkillModal('{{ .name }}', '{{ if .iconPath }}{{ .iconPath }}{{ else }}{{ .icon }}{{ end }}', '', '{{ .experience }}', '{{ if .iconPath }}svg{{ else }}emoji{{ end }}')"
                              data-skill-name="{{ .name }}"
                              data-skill-type="programming-language">
                            {{ partial "tech-icon.html" . }} {{ .name }}
                        </span>
                        {{ $found = true }}
                        {{ end }}
                        {{ end }}
                        {{ if not $found }}
                        <span class="skill-tag">{{ $skillName }}</span>
                        {{ end }}
                        {{ end }}
                        {{ range $exp.Params.frameworks_engines }}
                        {{ $skillName := . }}
                        {{ $found := false }}
                        {{ range $.Site.Data.frameworks_engines }}
                        {{ if eq .name $skillName }}
                        <span class="skill-tag clickable" 
                              onclick="openSkillModal('{{ .name }}', '{{ if .iconPath }}{{ .iconPath }}{{ else }}{{ .icon }}{{ end }}', '', '{{ .experience }}', '{{ if .iconPath }}svg{{ else }}emoji{{ end }}')"
                              data-skill-name="{{ .name }}"
                              data-skill-type="framework-engine">
                            {{ partial "tech-icon.html" . }} {{ .name }}
                        </span>
                        {{ $found = true }}
                        {{ end }}
                        {{ end }}
                        {{ if not $found }}
                        <span class="skill-tag">{{ $skillName }}</span>
                        {{ end }}
                        {{ end }}
                        {{ range $exp.Params.tools }}
                        {{ $skillName := . }}
                        {{ $found := false }}
                        {{ range $.Site.Data.tools }}
                        {{ if eq .name $skillName }}
                        <span class="skill-tag clickable" 
                              onclick="openSkillModal('{{ .name }}', '{{ if .iconPath }}{{ .iconPath }}{{ else }}{{ .icon }}{{ end }}', '{{ .description }}', '{{ .experience }}', '{{ if .iconPath }}svg{{ else }}emoji{{ end }}')"
                              data-skill-name="{{ .name }}"
                              data-skill-type="tool">
                            {{ partial "tech-icon.html" . }} {{ .name }}
                        </span>
                        {{ $found = true }}
                        {{ end }}
                        {{ end }}
                        {{ if not $found }}
                        <span class="skill-tag">{{ $skillName }}</span>
                        {{ end }}
                        {{ end }}
                    </div>
                </div>

                {{ if or $exp.Params.specialties $exp.Params.soft_skills }}
                <div class="experience-skills">
                    <h5>{{ i18n "cross_skills" | default "Comp√©tences transversales :" }}</h5>
                    <div class="skills-tags">
                        {{ range $exp.Params.specialties }}
                        {{ $skillName := . }}
                        {{ $found := false }}
                        {{ range $.Site.Data.specialties }}
                        {{ if eq .name $skillName }}
                        <span class="skill-tag clickable" 
                              onclick="openSkillModal('{{ .name }}', '{{ if .iconPath }}{{ .iconPath }}{{ else }}{{ .icon }}{{ end }}', '', '{{ .experience }}', '{{ if .iconPath }}svg{{ else }}emoji{{ end }}')"
                              data-skill-name="{{ .name }}"
                              data-skill-type="specialty">
                            {{ partial "tech-icon.html" . }} {{ .name }}
                        </span>
                        {{ $found = true }}
                        {{ end }}
                        {{ end }}
                        {{ if not $found }}
                        <span class="skill-tag">{{ $skillName }}</span>
                        {{ end }}
                        {{ end }}
                        {{ range $exp.Params.soft_skills }}
                        {{ $skillName := . }}
                        {{ $found := false }}
                        {{ range $.Site.Data.soft_skills }}
                        {{ if eq .name $skillName }}
                        <span class="skill-tag clickable" 
                              onclick="openSkillModal('{{ .name }}', '{{ if .iconPath }}{{ .iconPath }}{{ else }}{{ .icon }}{{ end }}', '', '{{ .experience }}', '{{ if .iconPath }}svg{{ else }}emoji{{ end }}')"
                              data-skill-name="{{ .name }}"
                              data-skill-type="soft-skill">
                            {{ partial "tech-icon.html" . }} {{ .name }}
                        </span>
                        {{ $found = true }}
                        {{ end }}
                        {{ end }}
                        {{ if not $found }}
                        <span class="skill-tag">{{ $skillName }}</span>
                        {{ end }}
                        {{ end }}
                    </div>
                </div>
                {{ end }}
            </div>
        </div>
        {{ end }}
    </div>

    <!-- Internships Timeline -->
    <div class="experience-timeline" id="internships-timeline" data-tab="internships" style="display: none;">
        {{ range $index, $int := .Site.Data.internships }}
        <div class="experience-card seeking">
            <div class="experience-header-card">
                <div class="company-info">
                    <div class="company-logo">
                        <div class="seeking-icon">üîç</div>
                    </div>
                    <div class="company-details">
                        <h3 class="job-title">{{ $int.title }}</h3>
                        <h4 class="company-name">{{ $int.company }}</h4>
                        <div class="job-meta">
                            <span class="job-period">{{ $int.period }}</span>
                            <span class="job-duration">{{ $int.duration }}</span>
                        </div>
                        <div class="job-info">
                            <span class="job-type">{{ $int.type }}</span>
                            <span class="job-location">üìç {{ $int.location }}</span>
                        </div>
                    </div>
                </div>
                <div class="seeking-badge">{{ i18n "actively_seeking" | default "Recherche active" }}</div>
            </div>

            <div class="experience-content">
                <p class="experience-description">{{ $int.description }}</p>

                {{ if $int.requirements }}
                <div class="requirements-section">
                    <h5>{{ i18n "looking_for" | default "Recherch√© :" }}</h5>
                    <ul class="requirements-list">
                        {{ range $int.requirements }}
                        <li>{{ . }}</li>
                        {{ end }}
                    </ul>
                </div>
                {{ end }}

                <div class="experience-skills">
                    <h5>{{ i18n "skills_to_apply" | default "Comp√©tences √† mettre en ≈ìuvre :" }}</h5>
                    <div class="skills-tags">
                        {{ range $int.skills }}
                        {{ $skillName := . }}
                        {{ $found := false }}
                        {{ range ($.Site.Data.programming_languages | append $.Site.Data.frameworks_engines | append $.Site.Data.specialties | append $.Site.Data.tools) }}
                        {{ if eq .name $skillName }}
                        <span class="skill-tag clickable" 
                              onclick="openSkillModal('{{ .name }}', '{{ if .iconPath }}{{ .iconPath }}{{ else }}{{ .icon }}{{ end }}', '{{ .description }}', '{{ .experience }}', '{{ if .iconPath }}svg{{ else }}emoji{{ end }}')"
                              data-skill-name="{{ .name }}"
                              data-skill-type="skill">
                            {{ partial "tech-icon.html" . }} {{ .name }}
                        </span>
                        {{ $found = true }}
                        {{ end }}
                        {{ end }}
                        {{ if not $found }}
                        <span class="skill-tag">{{ $skillName }}</span>
                        {{ end }}
                        {{ end }}
                    </div>
                </div>

                {{ if $int.technologies }}
                <div class="experience-technologies">
                    <h5>{{ i18n "preferred_technologies" | default "Technologies souhait√©es :" }}</h5>
                    <div class="tech-chips">
                        {{ range $int.technologies }}
                        {{ $techName := . }}
                        {{ $found := false }}
                        {{ $techType := "framework-engine" }}
                        {{ range $.Site.Data.programming_languages }}
                        {{ if eq .name $techName }}
                        {{ $techType = "programming-language" }}
                        <span class="tech-chip clickable" 
                              style="--tech-color: {{ .color | default "#666" }}"
                              onclick="openSkillModal('{{ .name }}', '{{ if .iconPath }}{{ .iconPath }}{{ else }}{{ .icon }}{{ end }}', '', '{{ .experience }}', '{{ if .iconPath }}svg{{ else }}emoji{{ end }}')"
                              data-skill-name="{{ .name }}"
                              data-skill-type="{{ $techType }}">
                            {{ partial "tech-icon.html" . }} {{ .name }}
                        </span>
                        {{ $found = true }}
                        {{ end }}
                        {{ end }}
                        {{ if not $found }}
                        {{ range $.Site.Data.frameworks_engines }}
                        {{ if eq .name $techName }}
                        <span class="tech-chip clickable" 
                              style="--tech-color: {{ .color | default "#666" }}"
                              onclick="openSkillModal('{{ .name }}', '{{ if .iconPath }}{{ .iconPath }}{{ else }}{{ .icon }}{{ end }}', '', '{{ .experience }}', '{{ if .iconPath }}svg{{ else }}emoji{{ end }}')"
                              data-skill-name="{{ .name }}"
                              data-skill-type="framework-engine">
                            {{ partial "tech-icon.html" . }} {{ .name }}
                        </span>
                        {{ $found = true }}
                        {{ end }}
                        {{ end }}
                        {{ end }}
                        {{ if not $found }}
                        <span class="tech-chip">{{ $techName }}</span>
                        {{ end }}
                        {{ end }}
                    </div>
                </div>
                {{ end }}
            </div>
        </div>
        {{ end }}
    </div>
</section>
