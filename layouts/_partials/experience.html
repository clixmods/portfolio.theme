<section class="experience-section">
    <div class="experience-header">
        <h2>Exp√©rience Professionnelle</h2>
        <p class="experience-subtitle">
            Mon parcours professionnel, des projets concrets aux comp√©tences d√©velopp√©es en entreprise
        </p>
    </div>

    <!-- Navigation Tabs -->
    <div class="experience-tabs">
        <button class="exp-tab-btn active" data-category="experiences">Exp√©riences</button>
        <button class="exp-tab-btn" data-category="internships">Stages & Recherche</button>
    </div>

    <!-- Experiences Timeline -->
    <div class="experience-timeline" id="experiences-timeline">
        {{ range $index, $exp := .Site.Data.experiences }}
        <div class="experience-card {{ if eq $exp.status "current" }}current{{ end }}">
            <div class="experience-header-card">
                <div class="company-info">
                    <div class="company-logo">
                        <img src="{{ $exp.logo }}" alt="{{ $exp.company }}" onerror="this.src='/images/placeholder-company.jpg'">
                    </div>
                    <div class="company-details">
                        <h3 class="job-title">{{ $exp.title }}</h3>
                        <h4 class="company-name">{{ $exp.company }}</h4>
                        <div class="job-meta">
                            <span class="job-period">{{ $exp.period }}</span>
                            <span class="job-duration">{{ $exp.duration }}</span>
                        </div>
                        <div class="job-info">
                            <span class="job-type">{{ $exp.type }}</span>
                            <span class="job-location">üìç {{ $exp.location }}</span>
                        </div>
                    </div>
                </div>
                {{ if eq $exp.status "current" }}
                <div class="current-badge">En cours</div>
                {{ end }}
            </div>

            <div class="experience-content">
                <p class="experience-description">{{ $exp.description }}</p>

                {{ if $exp.projects }}
                <div class="projects-section">
                    <div class="projects-header">
                        <h5>Projets principaux :</h5>
                        <div class="layout-controls">
                            <button class="layout-btn" data-layout="horizontal" title="Affichage grille">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M3,11H11V3H3M3,21H11V13H3M13,21H21V13H13M13,3V11H21V3"/>
                                </svg>
                            </button>
                            <button class="layout-btn" data-layout="vertical" title="Affichage liste">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M3,5H21V3H3M3,13H21V11H3M3,21H21V19H3"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    {{ $layout := $exp.projects_layout | default "horizontal" }}
                    <div class="projects-container projects-container-{{ $layout }}" data-default-layout="{{ $layout }}">
                    {{ range $exp.projects }}
                    <div class="project-item">
                        <!-- Project tile icon -->
                        <div class="project-tile-icon">üéØ</div>
                        
                        {{/* Handle project references */}}
                        {{ if .project_ref }}
                            {{/* Get project data from content */}}
                            {{ $projectPage := $.Site.GetPage (printf "/projects/%s" .project_ref) }}
                            {{ if $projectPage }}
                                <!-- Project image from referenced project -->
                                <div class="project-tile-image">
                                    {{ if $projectPage.Params.image }}
                                        <img src="{{ $projectPage.Params.image }}" 
                                             alt="{{ $projectPage.Title }}" 
                                             onerror="this.src='/images/placeholder-project.jpg'">
                                    {{ else }}
                                        <img src="/images/placeholder-project.jpg" alt="{{ $projectPage.Title }}">
                                    {{ end }}
                                    <div class="project-tile-overlay"></div>
                                </div>
                                
                                <!-- Default content (visible by default) -->
                                <div class="project-tile-content">
                                    <h6 class="project-name">{{ $projectPage.Title }}</h6>
                                    <p class="project-desc">{{ $projectPage.Params.description | default $projectPage.Params.subtitle }}</p>
                                </div>
                                
                                <!-- Detailed info (shown on hover) -->
                                <div class="project-tile-info">
                                    <div class="project-tile-info-content">
                                        <h6 class="project-name">{{ $projectPage.Title }}</h6>
                                        <p class="project-detailed-desc">
                                            {{ if .role_description }}{{ .role_description }}{{ else }}{{ $projectPage.Params.description }}{{ end }}
                                        </p>
                                        
                                        {{ if $projectPage.Params.technologies }}
                                        <div class="project-tile-tech">
                                            {{ range first 4 $projectPage.Params.technologies }}
                                            <span class="project-tile-tech-item">{{ . }}</span>
                                            {{ end }}
                                            {{ if gt (len $projectPage.Params.technologies) 4 }}
                                            <span class="project-tile-tech-item">+{{ sub (len $projectPage.Params.technologies) 4 }}</span>
                                            {{ end }}
                                        </div>
                                        {{ end }}
                                        
                                        <!-- Project actions -->
                                        <div class="project-tile-actions">
                                            <a href="{{ $projectPage.RelPermalink }}" class="project-tile-btn">
                                                <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                                                    <path d="M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z"/>
                                                </svg>
                                                Voir projet
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            {{ else }}
                                <!-- Fallback if project not found -->
                                <div class="project-tile-content">
                                    <h6 class="project-name">{{ .project_ref }}</h6>
                                    <p class="project-desc">Projet r√©f√©renc√© non trouv√©</p>
                                </div>
                            {{ end }}
                        {{ else }}
                            {{/* Handle inline project definition */}}
                            <!-- Project image (placeholder for inline projects) -->
                            <div class="project-tile-image">
                                <img src="/images/projects/{{ lower (.name | urlize) }}/thumbnail.jpg" 
                                     alt="{{ .name }}" 
                                     onerror="this.src='/images/placeholder-project.jpg'">
                                <div class="project-tile-overlay"></div>
                            </div>
                            
                            <!-- Default content (visible by default) -->
                            <div class="project-tile-content">
                                <h6 class="project-name">{{ .name }}</h6>
                                <p class="project-desc">{{ .description }}</p>
                            </div>
                            
                            <!-- Detailed info (shown on hover) -->
                            <div class="project-tile-info">
                                <div class="project-tile-info-content">
                                    <h6 class="project-name">{{ .name }}</h6>
                                    <p class="project-detailed-desc">
                                        {{ if .role_description }}{{ .role_description }}{{ else }}{{ .description }}{{ end }}
                                    </p>
                                    
                                    {{ if .tasks }}
                                    <ul class="project-tasks">
                                        {{ range .tasks }}
                                        <li>{{ . }}</li>
                                        {{ end }}
                                    </ul>
                                    {{ end }}
                                    
                                    {{ if .technologies }}
                                    <div class="project-tile-tech">
                                        {{ range .technologies }}
                                        <span class="project-tile-tech-item">{{ . }}</span>
                                        {{ end }}
                                    </div>
                                    {{ end }}
                                    
                                    <!-- Project actions -->
                                    <div class="project-tile-actions">
                                        {{ if .link }}
                                        <a href="{{ .link }}" class="project-tile-btn" target="_blank">
                                            <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z"/>
                                            </svg>
                                            Voir projet
                                        </a>
                                        {{ else }}
                                        <span class="project-tile-btn" style="opacity: 0.6;">
                                            <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                                                <path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M12,7C13.4,7 14.8,8.6 14.8,10.1V11.1C14.8,11.6 14.4,12 13.9,12H10.1C9.6,12 9.2,11.6 9.2,11.1V10.1C9.2,8.6 10.6,7 12,7Z"/>
                                            </svg>
                                            Confidentiel
                                        </span>
                                        {{ end }}
                                    </div>
                                </div>
                            </div>
                        {{ end }}
                    </div>
                    {{ end }}
                    </div>
                </div>
                {{ else if $exp.tasks }}
                <div class="tasks-section">
                    <h5>Responsabilit√©s :</h5>
                    <ul class="experience-tasks">
                        {{ range $exp.tasks }}
                        <li>{{ . }}</li>
                        {{ end }}
                    </ul>
                </div>
                {{ end }}

                <div class="experience-skills">
                    <h5>Comp√©tences d√©velopp√©es :</h5>
                    <div class="skills-tags">
                        {{ range $exp.skills }}
                        <span class="skill-tag">{{ . }}</span>
                        {{ end }}
                    </div>
                </div>

                {{ if $exp.technologies }}
                <div class="experience-technologies">
                    <h5>Technologies utilis√©es :</h5>
                    <div class="tech-chips">
                        {{ range $exp.technologies }}
                        {{ $techName := . }}
                        {{ $found := false }}
                        {{ range $.Site.Data.technologies }}
                        {{ if eq .name $techName }}
                        <span class="tech-chip" style="--tech-color: {{ .color | default "#666" }}">{{ partial "tech-icon.html" . }} {{ .name }}</span>
                        {{ $found = true }}
                        {{ end }}
                        {{ end }}
                        {{ if not $found }}
                        <span class="tech-chip">{{ $techName }}</span>
                        {{ end }}
                        {{ end }}
                    </div>
                </div>
                {{ end }}
            </div>
        </div>
        {{ end }}
    </div>

    <!-- Internships Timeline -->
    <div class="experience-timeline" id="internships-timeline" style="display: none;">
        {{ range $index, $int := .Site.Data.internships }}
        <div class="experience-card seeking">
            <div class="experience-header-card">
                <div class="company-info">
                    <div class="company-logo">
                        <div class="seeking-icon">üîç</div>
                    </div>
                    <div class="company-details">
                        <h3 class="job-title">{{ $int.title }}</h3>
                        <h4 class="company-name">{{ $int.company }}</h4>
                        <div class="job-meta">
                            <span class="job-period">{{ $int.period }}</span>
                            <span class="job-duration">{{ $int.duration }}</span>
                        </div>
                        <div class="job-info">
                            <span class="job-type">{{ $int.type }}</span>
                            <span class="job-location">üìç {{ $int.location }}</span>
                        </div>
                    </div>
                </div>
                <div class="seeking-badge">Recherche active</div>
            </div>

            <div class="experience-content">
                <p class="experience-description">{{ $int.description }}</p>

                {{ if $int.requirements }}
                <div class="requirements-section">
                    <h5>Recherch√© :</h5>
                    <ul class="requirements-list">
                        {{ range $int.requirements }}
                        <li>{{ . }}</li>
                        {{ end }}
                    </ul>
                </div>
                {{ end }}

                <div class="experience-skills">
                    <h5>Comp√©tences √† mettre en ≈ìuvre :</h5>
                    <div class="skills-tags">
                        {{ range $int.skills }}
                        <span class="skill-tag">{{ . }}</span>
                        {{ end }}
                    </div>
                </div>

                {{ if $int.technologies }}
                <div class="experience-technologies">
                    <h5>Technologies souhait√©es :</h5>
                    <div class="tech-chips">
                        {{ range $int.technologies }}
                        {{ $techName := . }}
                        {{ $found := false }}
                        {{ range $.Site.Data.technologies }}
                        {{ if eq .name $techName }}
                        <span class="tech-chip" style="--tech-color: {{ .color | default "#666" }}">{{ partial "tech-icon.html" . }} {{ .name }}</span>
                        {{ $found = true }}
                        {{ end }}
                        {{ end }}
                        {{ if not $found }}
                        <span class="tech-chip">{{ $techName }}</span>
                        {{ end }}
                        {{ end }}
                    </div>
                </div>
                {{ end }}
            </div>
        </div>
        {{ end }}
    </div>
</section>
