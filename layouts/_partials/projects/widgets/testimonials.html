{{/*
  Partial: Testimonials Widget
  Description: Widget compact pour afficher les témoignages d'un projet
  Context: 
    - .Params (dict) - Paramètres du projet avec .testimonials
    - .File.BaseFileName (string) - ID du projet
*/}}

{{- if .Params.testimonials -}}
<div class="project-widget widget-testimonials-box {{ .Params.testimonials_size | default "size-large" }}">
  <div class="project-widget-header" onclick="toggleInfoBox(this)">
    <div class="project-widget-header-content">
      <h3 class="project-widget-title">Témoignages</h3>
      <!-- Aperçu rotatif des testimonials -->
      {{- if .Params.testimonials -}}
      <div class="widget-testimonials-preview">
        <div class="widget-testimonials-rotator">
          {{- range $index, $testimonial := .Params.testimonials -}}
            {{- $person := partial "helpers/get-person.html" (dict "context" $ "personId" $testimonial.person) -}}
            {{- if $person -}}
          <div class="widget-testimonial-preview-item {{ if eq $index 0 }}active{{ end }}" data-index="{{ $index }}">
            <div class="widget-testimonial-preview-header{{ if $person }} clickable-person{{ end }}"{{ if $person }} data-person-id="{{ $testimonial.person }}" title="Voir le profil de {{ $person.Params.title }}"{{ end }}>
              <div class="widget-testimonial-preview-avatar {{ if not $person.Params.avatar }}placeholder{{ end }}">
                {{- if $person.Params.avatar -}}
                <img src="{{ $person.Params.avatar }}" alt="{{ $person.Params.title }}">
                {{- else -}}
                <span>{{ substr $person.Params.title 0 1 | upper }}</span>
                {{- end -}}
              </div>
              <div class="widget-testimonial-preview-author">{{ $person.Params.title }}{{ if $testimonial.role }}, {{ $testimonial.role }}{{ end }}</div>
            </div>
            <div class="widget-testimonial-preview-quote">{{ $testimonial.quote }}</div>
          </div>
            {{- end -}}
          {{- end -}}
        </div>
        <div class="widget-testimonials-progress"></div>
      </div>
      {{- end -}}
    </div>
    <div class="project-widget-toggle">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"/>
      </svg>
    </div>
  </div>
  <div class="project-widget-content">
    {{/* Nouveau modal unifié pour les témoignages */}}
    {{ partial "projects/widgets/modal/testimonials.html" (dict "testimonials" .Params.testimonials "projectId" .File.BaseFileName "context" .) }}
  </div>
</div>
{{- end -}}