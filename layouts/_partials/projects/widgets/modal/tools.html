{{/*
  Partial: Tools Modal Layout
  Description: Structure HTML pour l'affichage des outils utilis√©s dans les modals de project widget
  Context: 
    - .tools (slice) - Liste des outils utilis√©s dans le projet
    - .projectId (string) - ID du projet pour contextualiser les actions
    - .profileData (dict) - Donn√©es du profil pour la section d√©veloppeur
*/}}

{{- $tools := .tools -}}
{{- $projectId := .projectId | default "" -}}
{{- $profileData := .profileData -}}

{{/* DEBUG - Affichage des outils re√ßus */}}
<!-- DEBUG: Tools received: {{ $tools }} -->
<!-- DEBUG: Total tools in data: {{ len site.Data.tools }} -->

{{/* R√©cup√©ration des donn√©es des outils depuis site.Data.tools */}}
{{- $allTools := site.Data.tools -}}
{{- $usedTools := slice -}}
{{- $totalExperience := 0 -}}
{{- $toolCategories := dict -}}

{{/* Traitement des outils utilis√©s - matching by .key */}}
{{- range $toolKey := $tools -}}
  {{- range $allTools -}}
    {{- if eq .key $toolKey -}}
      {{- $usedTools = $usedTools | append . -}}
      {{- $totalExperience = add $totalExperience .experience -}}
      
      {{/* Groupement par cat√©gorie */}}
      {{- $category := .category | default "other" -}}
      {{- $categoryTools := index $toolCategories $category | default slice -}}
      {{- $categoryTools = $categoryTools | append . -}}
      {{- $toolCategories = merge $toolCategories (dict $category $categoryTools) -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

{{- $total := len $usedTools -}}

{{- if gt $total 0 -}}
  <div class="tools-modal">
    {{/* Barre de statistiques */}}
    <div class="tools-stats-bar">
      <div class="widget-count">
        <strong>{{ $total }}</strong> {{ if eq $total 1 }}{{ i18n "tool_lowercase" | default "outil" }}{{ else }}{{ i18n "tools_lowercase" | default "outils" }}{{ end }}
      </div>
      {{/* Affichage des cat√©gories regroup√©es */}}
      <div class="tools-categories">
        {{- $displayedCategories := dict -}}
        {{- range $category, $categoryTools := $toolCategories -}}
          {{- $categoryKey := printf "tool_category_%s" $category -}}
          {{- $categoryName := i18n $categoryKey | default $category -}}
          
          {{/* Regroupement des cat√©gories avec le m√™me nom */}}
          {{- $existingTools := index $displayedCategories $categoryName | default slice -}}
          {{- $existingTools = $existingTools | append $categoryTools -}}
          {{- $displayedCategories = merge $displayedCategories (dict $categoryName $existingTools) -}}
        {{- end -}}
        
        {{/* Affichage des cat√©gories regroup√©es */}}
        {{- range $displayName, $toolGroups := $displayedCategories -}}
          {{- $totalTools := 0 -}}
          {{- range $toolGroups -}}
            {{- $totalTools = add $totalTools (len .) -}}
          {{- end -}}
          <div class="tool-category-chip widget-badge widget-badge--sm">
            {{ $displayName }} ({{ $totalTools }})
          </div>
        {{- end -}}
      </div>
    </div>
    
    {{/* Note d√©veloppeur */}}
    {{- if $profileData -}}
    <div class="developer-profile-note">
      <div class="profile-avatar widget-icon widget-icon--lg">
        <img src="{{ $profileData.media.profileImage }}" alt="{{ $profileData.personal.fullName }}" loading="lazy">
      </div>
      <div class="profile-note-content">
        <div class="profile-note-title">{{ i18n "tools_used" | default "Outils utilis√©s" }} {{ i18n "by" | default "par" }} {{ $profileData.personal.firstName }} {{ i18n "for_this_project" | default "pour ce projet" }}</div>
        <div class="profile-note-subtitle">{{ $profileData.personal.title }}</div>
      </div>
    </div>
    {{- end -}}
    
    {{/* Grille des outils par cat√©gorie - regroup√©es par nom de cat√©gorie */}}
    {{- $sectionsByName := dict -}}
    {{- range $category, $categoryTools := $toolCategories -}}
      {{- $categoryKey := printf "tool_category_%s" $category -}}
      {{- $categoryName := i18n $categoryKey | default $category -}}
      
      {{/* Regrouper les outils par nom de cat√©gorie affich√© */}}
      {{- $existingTools := index $sectionsByName $categoryName | default slice -}}
      {{- range $categoryTools -}}
        {{- $existingTools = $existingTools | append . -}}
      {{- end -}}
      {{- $sectionsByName = merge $sectionsByName (dict $categoryName $existingTools) -}}
    {{- end -}}
    
    {{/* Afficher une section par nom de cat√©gorie */}}
    {{- range $sectionName, $sectionTools := $sectionsByName -}}
      <div class="tools-category-section">
        <div class="tools-category-title">{{ $sectionName }}</div>
        
        <div class="tools-grid">
          {{- range $sectionTools -}}
            {{- $toolName := i18n .key | default .key -}}
            {{- $descKey := printf "%s_desc" .key -}}
            {{- $toolDescription := i18n $descKey | default .description -}}
            {{- $toolExperience := .experience | default 0 -}}
            {{- $toolIcon := .iconPath | default "" -}}
            {{- $toolColor := .color | default "#666" -}}
            
            <div class="tool-card widget-card" 
                 data-tool="{{ $toolName }}" 
                 tabindex="0" 
                 role="button" 
                 aria-label="{{ i18n "view_details_of" | default "Voir les d√©tails de" }} {{ $toolName }}"
                 onclick="openSkillModal('{{ $toolName }}', '{{ if $toolIcon }}/{{ $toolIcon }}{{ else }}üõ†Ô∏è{{ end }}', '{{ i18n "tool" | default "Outil" }}', '{{ $toolExperience }}', '{{ if $toolIcon }}svg{{ else }}emoji{{ end }}', '{{ .key }}')"
                 style="cursor: pointer;">
              
              {{/* En-t√™te de l'outil */}}
              <div class="tool-header">
                <div class="tool-icon widget-icon widget-icon--lg" aria-hidden="true">
                  {{- if $toolIcon -}}
                    <img src="/{{ $toolIcon }}" alt="{{ $toolName }}" loading="lazy">
                  {{- else -}}
                    üõ†Ô∏è
                  {{- end -}}
                </div>
                <div class="tool-info">
                  <div class="tool-title">{{ $toolName }}</div>
                  {{- if $toolDescription -}}
                    <div class="tool-description">{{ $toolDescription }}</div>
                  {{- end -}}
                </div>
              </div>
              
              {{/* Badge avec ann√©es d'exp√©rience */}}
              <div class="tool-badge widget-badge">
                {{ $toolExperience }} {{ if eq $toolExperience 1 }}{{ i18n "year" | default "year" }}{{ else }}{{ i18n "years" | default "years" }}{{ end }}
              </div>
            </div>
          {{- end -}}
        </div>
      </div>
    {{- end -}}
    
    {{/* Note d'interaction */}}
    <div class="tools-interaction-note">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
        <path d="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z"/>
      </svg>
      {{ i18n "click_tool_see_projects" | default "Cliquez sur un outil pour voir les projets associ√©s et plus de d√©tails" }}
    </div>
  </div>
{{- else -}}
  <div class="tools-modal">
    <div class="tools-stats-bar">
      <div class="widget-count">
        <strong>0</strong> {{ i18n "tools_lowercase" | default "outils" }}
      </div>
    </div>
    
    <div class="tools-empty-state widget-note">
      <div class="widget-note-header">
        <div class="widget-note-icon widget-icon widget-icon--md">üõ†Ô∏è</div>
        <div class="widget-note-title">{{ i18n "no_specific_tool" | default "Aucun outil sp√©cifique" }}</div>
      </div>
      <div class="widget-note-content">
        <p>{{ i18n "no_tool_used" | default "Ce projet n'utilise pas d'outils sp√©cifiques r√©pertori√©s dans le portfolio." }}</p>
      </div>
    </div>
  </div>
{{- end -}}