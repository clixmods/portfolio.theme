{{/* Modal for displaying skill/technology details - Glassmorphism Design */}}
<div id="skillModal" class="skill-modal" style="display: none;">
    <div class="skill-modal-backdrop" onclick="closeSkillModal()"></div>
    <div class="skill-modal-content unified-modal-content">
        <div class="skill-modal-header unified-modal-header">
            <button class="skill-modal-close unified-modal-close" onclick="closeSkillModal()">&times;</button>

            <!-- Unified content header inside header -->
            <div class="skill-info skill-modal-header-section unified-modal-content-header">
                <div class="skill-modal-header-left unified-modal-content-header-left">
                    <div class="skill-modal-skill-icon-large unified-modal-icon-large" id="skillIconLarge">
                        <span id="modalSkillIcon"></span>
                    </div>
                    <div class="skill-modal-title-block unified-modal-title-block">
                        <h2 id="modalSkillName"></h2>
                        <div class="skill-modal-chips unified-modal-chips">
                            <span class="skill-modal-chip chip" id="modalSkillLevel" hidden></span>
                            <span class="skill-modal-chip chip secondary" id="modalSkillExperience" hidden></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Unified tab bar inside header with collapse support -->
            <!-- The dropdown will be automatically generated by tabs-dropdown.js on mobile -->
            <div class="skill-modal-tabs unified-modal-tabs tabs" role="tablist" data-can-collapse="true" data-collapse-id="skillModal">
                <button class="skill-modal-tab tab-btn active" role="tab" aria-selected="true" aria-controls="skillModalTabProjects" data-tab="projects">
                    <span class="icon">üíº</span><span>{{ i18n "skill_modal_tab_projects" }}</span>
                    <span class="skill-modal-tab-count count" id="skillModalProjectsCount"></span>
                </button>
                <button class="skill-modal-tab tab-btn" role="tab" aria-selected="false" aria-controls="skillModalTabExperiences" data-tab="experiences">
                    <span class="icon">üè¢</span><span>{{ i18n "skill_modal_tab_experiences" }}</span>
                    <span class="skill-modal-tab-count count" id="skillModalExperiencesCount"></span>
                </button>
                <button class="skill-modal-tab tab-btn" role="tab" aria-selected="false" aria-controls="skillModalTabEducations" data-tab="educations">
                    <span class="icon">üéì</span><span>{{ i18n "skill_modal_tab_educations" }}</span>
                    <span class="skill-modal-tab-count count" id="skillModalEducationsCount"></span>
                </button>
            </div>
        </div>

        <div class="skill-modal-body unified-modal-body skill-modal-layout">
            <!-- Panels -->
            <div class="skill-modal-tab-panels unified-modal-panels">
                <div class="skill-modal-tab-panel unified-modal-panel active" id="skillModalTabProjects" role="tabpanel" aria-labelledby="skillModalTabBtnProjects">
                    <div id="modalProjectsList" class="skill-modal-projects-grid" data-empty-text="Aucun projet trouv√© pour cette technologie.">
                        <!-- Projects -->
                    </div>
                </div>
                <div class="skill-modal-tab-panel unified-modal-panel" id="skillModalTabExperiences" role="tabpanel" aria-labelledby="skillModalTabBtnExperiences" hidden>
                    <div id="modalExperiencesList" class="skill-modal-experiences-list" data-empty-text="Aucune exp√©rience trouv√©e.">
                        <!-- Experiences -->
                    </div>
                </div>
                <div class="skill-modal-tab-panel unified-modal-panel" id="skillModalTabEducations" role="tabpanel" aria-labelledby="skillModalTabBtnEducations" hidden>
                    <div id="modalEducationsList" class="skill-modal-educations-list" data-empty-text="Aucune formation trouv√©e.">
                        <!-- Educations -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Tab management & skill modal statistics
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('skillModal');
    if (!modal) return;
    
    // Initialize TabController for skill modal - scoped to modal context to avoid interference
    const skillModalTabs = new TabController('#skillModal .skill-modal-tab', {
        contentSelector: '#skillModal .skill-modal-tab-panel',
        contentAttribute: 'data-tab',
        animationType: 'none', // Use CSS animations via class changes instead
        useHiddenAttribute: true,
        contentMatchingStrategy: 'id-pattern',
        idPattern: 'skillModalTab{Category}',
        enableKeyboardNav: true
    });
    
    const counts = {
        projects: document.getElementById('skillModalProjectsCount'),
        experiences: document.getElementById('skillModalExperiencesCount'),
        educations: document.getElementById('skillModalEducationsCount')
    };
    // quick stats removed

    // Hook into existing openSkillModal function to update statistics and activate default tab
    const originalOpen = window.openSkillModal;
    if (typeof originalOpen === 'function') {
        window.openSkillModal = function(name, icon, level, experience, iconType, skillKey) {
            originalOpen(name, icon, level, experience, iconType, skillKey);
            
            // Use skillKey for filtering if provided, otherwise fallback to name
            const searchKey = skillKey || name;

            // Level chip: hide if "Non sp√©cifi√©" or empty
            try {
                const lvlEl = document.getElementById('modalSkillLevel');
                if (lvlEl) {
                    const raw = lvlEl.textContent ? lvlEl.textContent.trim() : '';
                    let hide = false;
                    if (!raw) hide = true;
                    else {
                        const normalized = raw.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase();
                        if (normalized === 'non specifie') hide = true;
                    }
                    if (hide) {
                        lvlEl.textContent = '';
                        lvlEl.style.display = 'none';
                        lvlEl.hidden = true;
                    } else {
                        lvlEl.style.display = '';
                        lvlEl.hidden = false;
                    }
                }
            } catch (e) { /* no-op */ }

            // Experience chip is now handled entirely by skill-modal.js with i18n support
            // No need to update it here - the JavaScript handles it properly

            updateStats(searchKey);
            skillModalTabs.activateTab('projects');
        };
    }

    function updateStats(skillName) {
        const normalize = v => Array.isArray(v) ? v : (v ? [v] : []);
        const hasSkill = (arr) => arr.some(t => t && (t === skillName || t.toLowerCase() === skillName.toLowerCase()));

        const proj = (window.portfolioProjects||[]).filter(p => hasSkill(normalize(p.technologies||[])));
        const exp = (window.portfolioExperiences||[]).filter(e => hasSkill(normalize(e.technologies||[])));
        const edu = (window.portfolioEducations||[]).filter(ed => hasSkill(normalize(ed.technologies||[])));

        if (counts.projects) counts.projects.textContent = proj.length > 0 ? proj.length : '0';
        if (counts.experiences) counts.experiences.textContent = exp.length > 0 ? exp.length : '0';
        if (counts.educations) counts.educations.textContent = edu.length > 0 ? edu.length : '0';

        // quick stats removed
    }
});
</script>
