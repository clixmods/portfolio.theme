{{- define "main" -}}
<!-- Utilisation du CSS education existant -->
{{ with resources.Get "css/education.css" }}
<link rel="stylesheet" href="{{ .RelPermalink }}">
{{ end }}
{{ with resources.Get "css/tabs.css" }}
<link rel="stylesheet" href="{{ .RelPermalink }}">
{{ end }}

<style>
/* Ajustement pour le dock en haut */
.education-section {
    padding-top: 120px !important; /* Compense la hauteur du dock fixe */
    margin-top: 0 !important; /* Retire le margin-top par dÃ©faut */
}
</style>

<section class="education-section">
    <div class="section-header-unified">
        <h2 class="section-title-unified">{{ .Title | default "Formations" }}</h2>
        <p class="section-subtitle-unified">{{ .Params.description | default .Content | default "Mon parcours acadÃ©mique et professionnel, construisant les fondations de mon expertise technique" }}</p>
    </div>

    <!-- Navigation Tabs -->
    {{- $certificationsData := partial "get-localized-data.html" (dict "context" . "dataName" "certifications") -}}
    {{ $hasCertifications := gt (len $certificationsData) 0 }}
    <div class="tabs" data-can-collapse="true" data-collapse-id="educationsList">
        <button class="tab-btn active" data-tab="education">
            <span class="icon">ðŸŽ“</span>
            <span class="tab-label">{{ i18n "education" | default "Formation" }}</span>
        </button>
        {{ if $hasCertifications }}
        <button class="tab-btn" data-tab="certifications">
            <span class="icon">ðŸ“œ</span>
            <span class="tab-label">{{ i18n "certifications" | default "Certifications" }}</span>
        </button>
        {{ end }}
    </div>

    <!-- Education Timeline -->
    <div class="timeline-container" id="education-timeline" data-tab="education">
        <div class="timeline-line"></div>
        
        {{ range ((where .Site.RegularPages "Section" "educations").ByParam "end_date").Reverse }}
        {{ if ne .File.BaseFileName "_index" }}
        <div class="timeline-item education-item" data-category="education">
            {{ partial "components/timeline-marker.html" (dict "color" .Params.color "logo" .Params.school_logo "icon" .Params.icon "alt" .Params.institution) }}
            
            <div class="timeline-content">
                <div class="timeline-card">
                    <div class="timeline-header">
                        <div class="timeline-period">
                            {{ partial "helpers/format-period.html" (dict "startDate" .Params.start_date "endDate" .Params.end_date "context" .) }}
                        </div>
                        {{/* Use helper partial for status CSS class */}}
                        {{- $cssClass := partial "helpers/get-status-class.html" .Params.status -}}
                        <div class="timeline-status status-{{ $cssClass }}">{{ .Params.status }}</div>
                    </div>
                    
                    <h3 class="timeline-title">
                        <a href="{{ .RelPermalink }}">{{ .Title }}</a>
                    </h3>
                    <h4 class="timeline-institution">{{ .Params.institution }}{{ if .Params.city }} - {{ .Params.city }}{{ end }}</h4>
                    
                    <p class="timeline-description">{{ .Params.description }}</p>
                    
                    <div class="timeline-details">
                        <div class="timeline-results">
                            <strong>{{ i18n "results" | default "RÃ©sultats :" }}</strong>
                            <div class="results-badges">
                                {{ if .Params.years_detail }}
                                    {{/* Use custom year details with year-badge component */}}
                                    {{ range .Params.years_detail }}
                                        {{ partial "components/year-badge.html" (dict "year" .year "status" .status) }}
                                    {{ end }}
                                {{ else }}
                                    {{/* Classic automatic logic */}}
                                    {{ if or (eq .Params.status "Obtenu") (eq .Params.status "Obtained") }}
                                        {{ $startYear := dateFormat "2006" .Params.start_date }}
                                        {{ $endYear := dateFormat "2006" .Params.end_date }}
                                        {{ $duration := sub (int $endYear) (int $startYear) }}
                                        {{ range seq $duration }}
                                            {{ partial "components/year-badge.html" (dict "year" . "status" "validated") }}
                                        {{ end }}
                                    {{ else if or (eq .Params.status "En cours") (eq .Params.status "In progress") }}
                                        {{ $startYear := dateFormat "2006" .Params.start_date }}
                                        {{ $currentYear := now.Format "2006" }}
                                        {{ $yearsCompleted := sub (int $currentYear) (int $startYear) }}
                                        {{ if gt $yearsCompleted 0 }}
                                            {{ range seq $yearsCompleted }}
                                                {{ partial "components/year-badge.html" (dict "year" . "status" "validated") }}
                                            {{ end }}
                                        {{ end }}
                                        {{ partial "components/year-badge.html" (dict "year" (add $yearsCompleted 1) "status" "in_progress") }}
                                    {{ else }}
                                        <div class="result-badge general">
                                            <span class="badge-icon">ðŸ“š</span>
                                            <span class="badge-text">{{ i18n "education" | default "Formation" }}</span>
                                            <span class="badge-status">{{ .Params.grade }}</span>
                                        </div>
                                    {{ end }}
                                {{ end }}
                            </div>
                        </div>
                        
                        {{ if or .Params.programming_languages .Params.frameworks_engines .Params.tools }}
                        <div class="timeline-skills">
                            <strong>{{ i18n "technical_skills_label" | default "CompÃ©tences techniques :" }}</strong>
                            <div class="skills-tags">
                                {{ range .Params.programming_languages }}
                                {{/* Support both old format (string) and new format (object with displayInList) */}}
                                {{ $skillKey := "" }}
                                {{ $shouldDisplay := true }}
                                {{ if reflect.IsMap . }}
                                    {{ $skillKey = .language }}
                                    {{ $shouldDisplay = .displayInList | default true }}
                                {{ else }}
                                    {{ $skillKey = . }}
                                {{ end }}
                                {{ if $shouldDisplay }}
                                {{ $found := false }}
                                {{ range $.Site.Data.programming_languages }}
                                {{ if eq .key $skillKey }}
                                {{ $localizedName := i18n .key | default .key }}
                                <span class="skill-tag clickable" 
                                      onclick="openSkillModal('{{ $localizedName }}', '{{ if .iconPath }}{{ .iconPath }}{{ else }}{{ .icon }}{{ end }}', '', '{{ .experience }}', '{{ if .iconPath }}svg{{ else }}emoji{{ end }}', '{{ .key }}')"
                                      data-skill-name="{{ .key }}"
                                      data-skill-type="programming-language">
                                    {{ partial "tech/tech-icon.html" . }} {{ $localizedName }}
                                </span>
                                {{ $found = true }}
                                {{ end }}
                                {{ end }}
                                {{ if not $found }}
                                <span class="skill-tag programming">{{ i18n $skillKey | default $skillKey }}</span>
                                {{ end }}
                                {{ end }}
                                {{ end }}
                                {{ range .Params.frameworks_engines }}
                                {{ $skillKey := "" }}
                                {{ $shouldDisplay := true }}
                                {{ if reflect.IsMap . }}
                                    {{ $skillKey = .framework }}
                                    {{ $shouldDisplay = .displayInList | default true }}
                                {{ else }}
                                    {{ $skillKey = . }}
                                {{ end }}
                                {{ if $shouldDisplay }}
                                {{ $found := false }}
                                {{ range $.Site.Data.frameworks_engines }}
                                {{ if eq .key $skillKey }}
                                {{ $localizedName := i18n .key | default .key }}
                                <span class="skill-tag clickable" 
                                      onclick="openSkillModal('{{ $localizedName }}', '{{ if .iconPath }}{{ .iconPath }}{{ else }}{{ .icon }}{{ end }}', '', '{{ .experience }}', '{{ if .iconPath }}svg{{ else }}emoji{{ end }}', '{{ .key }}')"
                                      data-skill-name="{{ .key }}"
                                      data-skill-type="framework-engine">
                                    {{ partial "tech/tech-icon.html" . }} {{ $localizedName }}
                                </span>
                                {{ $found = true }}
                                {{ end }}
                                {{ end }}
                                {{ if not $found }}
                                <span class="skill-tag framework">{{ i18n $skillKey | default $skillKey }}</span>
                                {{ end }}
                                {{ end }}
                                {{ end }}
                                {{ range .Params.tools }}
                                {{ $skillKey := "" }}
                                {{ $shouldDisplay := true }}
                                {{ if reflect.IsMap . }}
                                    {{ $skillKey = .tool }}
                                    {{ $shouldDisplay = .displayInList | default true }}
                                {{ else }}
                                    {{ $skillKey = . }}
                                {{ end }}
                                {{ if $shouldDisplay }}
                                {{ $found := false }}
                                {{ range $.Site.Data.tools }}
                                {{ if eq .key $skillKey }}
                                {{ $localizedName := i18n .key | default .key }}
                                <span class="skill-tag clickable" 
                                      onclick="openSkillModal('{{ $localizedName }}', '{{ if .iconPath }}{{ .iconPath }}{{ else }}{{ .icon }}{{ end }}', '{{ .description }}', '{{ .experience }}', '{{ if .iconPath }}svg{{ else }}emoji{{ end }}', '{{ .key }}')"
                                      data-skill-name="{{ .key }}"
                                      data-skill-type="tool">
                                    {{ partial "tech/tech-icon.html" . }} {{ $localizedName }}
                                </span>
                                {{ $found = true }}
                                {{ end }}
                                {{ end }}
                                {{ if not $found }}
                                <span class="skill-tag tool">{{ i18n $skillKey | default $skillKey }}</span>
                                {{ end }}
                                {{ end }}
                                {{ end }}
                            </div>
                        </div>
                        {{ end }}
                        
                        {{ if or .Params.specialties .Params.soft_skills }}
                        <div class="timeline-skills">
                            <strong>{{ i18n "cross_skills_label" | default "CompÃ©tences transversales :" }}</strong>
                            <div class="skills-tags">
                                {{ range .Params.specialties }}
                                {{ $skillKey := "" }}
                                {{ $shouldDisplay := true }}
                                {{ if reflect.IsMap . }}
                                    {{ $skillKey = .specialty }}
                                    {{ $shouldDisplay = .displayInList | default true }}
                                {{ else }}
                                    {{ $skillKey = . }}
                                {{ end }}
                                {{ if $shouldDisplay }}
                                {{ $found := false }}
                                {{ range $.Site.Data.specialties }}
                                {{ if eq .key $skillKey }}
                                {{ $localizedName := i18n .key | default .key }}
                                <span class="skill-tag clickable" 
                                      onclick="openSkillModal('{{ $localizedName }}', '{{ if .iconPath }}{{ .iconPath }}{{ else }}{{ .icon }}{{ end }}', '', '{{ .experience }}', '{{ if .iconPath }}svg{{ else }}emoji{{ end }}', '{{ .key }}')"
                                      data-skill-name="{{ .key }}"
                                      data-skill-type="specialty">
                                    {{ partial "tech/tech-icon.html" . }} {{ $localizedName }}
                                </span>
                                {{ $found = true }}
                                {{ end }}
                                {{ end }}
                                {{ if not $found }}
                                <span class="skill-tag specialty">{{ i18n $skillKey | default $skillKey }}</span>
                                {{ end }}
                                {{ end }}
                                {{ end }}
                                {{ range .Params.soft_skills }}
                                {{ $skillKey := "" }}
                                {{ $shouldDisplay := true }}
                                {{ if reflect.IsMap . }}
                                    {{ $skillKey = .skill }}
                                    {{ $shouldDisplay = .displayInList | default true }}
                                {{ else }}
                                    {{ $skillKey = . }}
                                {{ end }}
                                {{ if $shouldDisplay }}
                                {{ $found := false }}
                                {{ range $.Site.Data.soft_skills }}
                                {{ if eq .key $skillKey }}
                                {{ $localizedName := i18n .key | default .key }}
                                <span class="skill-tag clickable" 
                                      onclick="openSkillModal('{{ $localizedName }}', '{{ if .iconPath }}{{ .iconPath }}{{ else }}{{ .icon }}{{ end }}', '', '{{ .experience }}', '{{ if .iconPath }}svg{{ else }}emoji{{ end }}', '{{ .key }}')"
                                      data-skill-name="{{ .key }}"
                                      data-skill-type="soft-skill">
                                    {{ partial "tech/tech-icon.html" . }} {{ $localizedName }}
                                </span>
                                {{ $found = true }}
                                {{ end }}
                                {{ end }}
                                {{ if not $found }}
                                <span class="skill-tag soft">{{ i18n $skillKey | default $skillKey }}</span>
                                {{ end }}
                                {{ end }}
                                {{ end }}
                            </div>
                        </div>
                        {{ end }}
                    </div>
                </div>
            </div>
        </div>
        {{ end }}
        {{ end }}
    </div>

    <!-- Certifications Timeline -->
    {{ if $hasCertifications }}
    <div class="timeline-container" id="certifications-timeline" data-tab="certifications" style="display: none;">
        <div class="timeline-line"></div>
        
        {{ range $index, $cert := $certificationsData }}
        <div class="timeline-item certification-item" data-category="certifications">
            {{ partial "components/timeline-marker.html" (dict "color" $cert.color "icon" $cert.icon "alt" $cert.title) }}
            
            <div class="timeline-content">
                <div class="timeline-card">
                    <div class="timeline-header">
                        <div class="timeline-period">{{ $cert.date }}</div>
                        <div class="timeline-status status-{{ lower $cert.status }}">{{ $cert.status }}</div>
                    </div>
                    
                    <h3 class="timeline-title">{{ $cert.title }}</h3>
                    <h4 class="timeline-institution">{{ $cert.issuer }}</h4>
                    
                    <p class="timeline-description">{{ $cert.description }}</p>
                </div>
            </div>
        </div>
        {{ end }}
    </div>
    {{ end }}
</section>

<!-- Education tabs using TabController -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Education tabs using TabController with fade animation
    const educationTabs = new TabController('.education-section .tab-btn', {
        contentSelector: '.timeline-container[data-tab]',
        contentAttribute: 'data-tab',
        animationType: 'fade',
        animationDuration: 300
    });

    // Initialize timeline styles
    const timelines = [
        document.getElementById('education-timeline'),
        document.getElementById('certifications-timeline')
    ];
    timelines.forEach(timeline => {
        if (timeline) {
            timeline.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
        }
    });
});
</script>

{{- end -}}
